# AI PPT å›¾ç‰‡ç¼–è¾‘åŠŸèƒ½æ¶æ„è®¾è®¡

## 1. èƒŒæ™¯ä¸ç›®æ ‡

### 1.1 èƒŒæ™¯

å½“å‰ AI PPTist System å·²å®ç°åŸºäºæ–‡ç”Ÿå›¾çš„ PPT è‡ªåŠ¨ç”ŸæˆåŠŸèƒ½ï¼ˆé¦™è•‰ç”Ÿæˆï¼‰ï¼Œè¯¥åŠŸèƒ½é€šè¿‡ä»¥ä¸‹æµç¨‹ç”Ÿæˆ PPTï¼š

1. ç”¨æˆ·è¾“å…¥ä¸»é¢˜ï¼ŒAI ç”Ÿæˆ PPT å¤§çº²
2. ç”¨æˆ·ç¡®è®¤å¤§çº²åï¼Œåç«¯åˆ†æå†…å®¹å¹¶è°ƒç”¨æ–‡ç”Ÿå›¾æ¨¡å‹ç”Ÿæˆ PPT å›¾ç‰‡
3. å‰ç«¯å°†ç”Ÿæˆçš„å›¾ç‰‡æ˜¾ç¤ºåœ¨ç¼–è¾‘å™¨ä¸­

**æ ¸å¿ƒé—®é¢˜**ï¼šç”±äºç”Ÿæˆçš„ PPT æ˜¯å›¾ç‰‡æ ¼å¼ï¼Œå¯¼è‡´å…¶ä¸­çš„æ–‡å­—å†…å®¹ä¸å¯ç¼–è¾‘ï¼Œé™åˆ¶äº†ç”¨æˆ·çš„åç»­ä¿®æ”¹èƒ½åŠ›ã€‚

### 1.2 ç›®æ ‡

åœ¨ç°æœ‰ç³»ç»Ÿä¸­å¢åŠ  **PPT å›¾ç‰‡è§£æåŠŸèƒ½**ï¼Œå®ç°ï¼š

1. ç‚¹å‡»å‰ç«¯å·¥å…·æ¡æŒ‰é’®è§¦å‘å›¾ç‰‡è§£æ
2. åç«¯è§£æå›¾ç‰‡ä¸­çš„æ–‡å­—ï¼Œè¯†åˆ«æ–‡å­—å†…å®¹åŠå…¶åœ¨å›¾ç‰‡ä¸­çš„åŒºåŸŸä½ç½®
3. å‰ç«¯å°† OCR ç»“æœè½¬æ¢ä¸º**çœŸå®çš„å¹»ç¯ç‰‡å…ƒç´ **å¹¶æ’å…¥å½“å‰ slideï¼ˆé®ç½© Shape + Text ç»„åˆï¼‰ï¼Œç”¨æˆ·å³å¯åƒæ™®é€šæ–‡æœ¬ä¸€æ ·ç¼–è¾‘/æ‹–æ‹½/ç¼©æ”¾/æ—‹è½¬

**è¯´æ˜**ï¼š
- æœ¬æ¬¡ä»…å®ç°â€œå›¾ç‰‡æ–‡å­—å¯ç¼–è¾‘â€çš„ç¼–è¾‘ä½“éªŒï¼šç¼–è¾‘ç»“æœå†™å…¥å‰ç«¯ `slidesStore`ï¼ˆå¯æ’¤é”€/é‡åšã€ä¼šè¯å†…æŒä¹…ï¼‰ï¼Œ**ä¸å›ä¼ åç«¯**ã€‚
- å¦‚éœ€å°†ä¿®æ”¹æŒä¹…åŒ–/å¯¼å‡ºä¸ºå¯ç¼–è¾‘ PPTXï¼Œå±äºæœªæ¥æ‰©å±•åŠŸèƒ½ã€‚

---

## 2. æ ¸å¿ƒåŠŸèƒ½æ¦‚è¿°

### 2.1 åŠŸèƒ½å®šä½

æœ¬åŠŸèƒ½ä¸“æ³¨äº **æ–‡å­—è¯†åˆ«ä¸åŒºåŸŸå®šä½**ï¼Œä¸æ¶‰åŠ PPT æ–‡ä»¶ä¿å­˜æˆ–æŒä¹…åŒ–ã€‚

**æ ¸å¿ƒèƒ½åŠ›**ï¼š
- æ–‡å­—æ£€æµ‹ï¼šè¯†åˆ«å›¾ç‰‡ä¸­æ‰€æœ‰æ–‡å­—åŒºåŸŸçš„ä½ç½®ï¼ˆè¾¹ç•Œæ¡†ï¼‰
- æ–‡å­—è¯†åˆ«ï¼šè¯†åˆ«æ¯ä¸ªåŒºåŸŸå†…çš„æ–‡å­—å†…å®¹
- åŒºåŸŸè¿”å›ï¼šè¿”å›æ–‡å­—å†…å®¹åŠå…¶å¯¹åº”çš„åæ ‡ä½ç½®
- å…ƒç´ åŒ–æ’å…¥ï¼šå‰ç«¯å°† OCR ç»“æœè½¬æ¢ä¸ºâ€œé®ç½© Shape + Textâ€å¹¶æ’å…¥å½“å‰ slide
- **å‰ç«¯ç¼–è¾‘**ï¼šåŸºäºç°æœ‰å…ƒç´ ä½“ç³»å®ç°ç¼–è¾‘ã€æ‹–æ‹½ç§»åŠ¨ã€è°ƒæ•´å¤§å°ã€æ—‹è½¬ï¼ˆå†™å…¥ `slidesStore`ï¼Œä¸å›ä¼ åç«¯ï¼‰

**ä¸åœ¨æœ¬æ¬¡èŒƒå›´**ï¼š
- âŒ ä¿å­˜ä¿®æ”¹åçš„æ–‡å­—åˆ°åç«¯
- âŒ é‡æ–°ç”Ÿæˆ PPT æ–‡ä»¶
- âŒ å¯¼å‡ºä¸ºå¯ç¼–è¾‘çš„ PPTX

### 2.2 ç”¨æˆ·äº¤äº’æµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ç”¨æˆ·æŸ¥çœ‹ç”Ÿæˆçš„  â”‚  â†’  â”‚  ç‚¹å‡»"è§£æå›¾ç‰‡"  â”‚  â†’  â”‚  æ˜¾ç¤ºè§£æè¿›åº¦   â”‚
â”‚  PPTå›¾ç‰‡        â”‚     â”‚  æŒ‰é’®            â”‚     â”‚                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                          â”‚
                                                          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ç¼–è¾‘æ–‡å­—å†…å®¹    â”‚  â†  â”‚  åœ¨å›¾ç‰‡ä¸Šå åŠ     â”‚  â†  â”‚  è§£æå®Œæˆ       â”‚
â”‚  (å†™å…¥slidesStoreâ”‚     â”‚  è½¬ä¸ºå¯ç¼–è¾‘å…ƒç´   â”‚     â”‚                 â”‚
â”‚   ä¸å›ä¼ åç«¯)    â”‚     â”‚  (é®ç½©+æ–‡æœ¬)     â”‚     â”‚                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 3. æŠ€æœ¯é€‰å‹åˆ†æ

### 3.1 MVP é˜¶æ®µ - æœ€ä½³æ¼”ç¤ºæ•ˆæœé€‰å‹

**é¡¹ç›®ç°çŠ¶ä¸éœ€æ±‚**ï¼š
- MVP åŸå‹éœ€è¦è‰¯å¥½çš„æ¼”ç¤ºæ•ˆæœ
- æ— é«˜æ€§èƒ½ GPU æœºå™¨
- æ— æ³•è¿›è¡Œå¤æ‚çš„ç¯å¢ƒéƒ¨ç½²
- éœ€è¦å¿«é€Ÿé›†æˆ

#### OCR æ–¹æ¡ˆå¯¹æ¯”ï¼ˆæŒ‰ç»¼åˆæ•ˆæœæ’åºï¼‰

| æ–¹æ¡ˆ | ç±»å‹ | è¯†åˆ«å‡†ç¡®ç‡ | éƒ¨ç½²å¤æ‚åº¦ | æ˜¯å¦éœ€è¦GPU | æˆæœ¬ | æ¼”ç¤ºæ¨èåº¦ |
|------|------|-----------|-----------|-----------|------|-----------|
| **è…¾è®¯äº‘OCR** | API | â­â­â­â­â­ 95%+ | â­ é›¶é…ç½® | âŒ ä¸éœ€è¦ | å…è´¹+ä»˜è´¹ | â­â­â­â­â­ |
| **é˜¿é‡Œäº‘OCR** | API | â­â­â­â­â­ 95%+ | â­ é›¶é…ç½® | âŒ ä¸éœ€è¦ | å…è´¹+ä»˜è´¹ | â­â­â­â­â­ |
| **ç™¾åº¦OCR** | API | â­â­â­â­ 90%+ | â­ é›¶é…ç½® | âŒ ä¸éœ€è¦ | å…è´¹+ä»˜è´¹ | â­â­â­â­ |
| **EasyOCR** | å¼€æº | â­â­â­ 85-90% | â­â­ éœ€å®‰è£… | âŒ CPUå¯ç”¨ | å…è´¹ | â­â­â­ |
| **PaddleOCR** | å¼€æº | â­â­â­â­ 90%+ | â­â­â­ å¤æ‚ | âœ… GPUæœ€ä½³ | å…è´¹ | â­â­ |

#### 3.1.1 MVP é¦–é€‰æ–¹æ¡ˆï¼šè…¾è®¯äº‘ OCR API

**é€‰æ‹©ç†ç”±**ï¼š

1. **è¯†åˆ«æ•ˆæœæœ€å¥½**
   - å‡†ç¡®ç‡ï¼š95%+ï¼ˆè¡Œä¸šé¢†å…ˆï¼‰
   - ä¸“ä¸ºPPTåœºæ™¯ä¼˜åŒ–
   - æ”¯æŒè¡¨æ ¼ã€å…¬å¼ç­‰å¤æ‚å†…å®¹

2. **é›¶é…ç½®éƒ¨ç½²**
   - æ— éœ€å®‰è£…ä»»ä½•OCRåº“
   - åªéœ€é…ç½®APIå¯†é’¥

3. **æ— éœ€GPU**
   - äº‘ç«¯å¤„ç†ï¼Œæœ¬åœ°æ— å‹åŠ›
   - ä»»ä½•æœºå™¨éƒ½èƒ½è¿è¡Œ

4. **å…è´¹é¢åº¦å……è¶³**
   - è…¾è®¯äº‘OCRæ¯æœˆå…è´¹é¢åº¦ï¼š
     - é€šç”¨å°åˆ·ä½“è¯†åˆ«ï¼š1000æ¬¡/æœˆ
     - å¢å¼ºå°åˆ·ä½“è¯†åˆ«ï¼š500æ¬¡/æœˆ
   - MVP æ¼”ç¤ºå®Œå…¨å¤Ÿç”¨


### 3.2 æŠ€æœ¯é€‰å‹æ€»ç»“

```
MVP é˜¶æ®µï¼ˆå½“å‰ï¼‰          ç”Ÿäº§ç¯å¢ƒï¼ˆæœªæ¥ï¼‰
    â”‚                          â”‚
    â–¼                          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ è…¾è®¯äº‘OCR   â”‚  â”€â”€â”€â”€â”€â”€> â”‚ è‡ªå»ºOCRé›†ç¾¤ â”‚
â”‚   API       â”‚  æˆæœ¬ä¼˜åŒ– â”‚ æˆ–æ··åˆäº‘    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
   5åˆ†é’Ÿé…ç½®                é™ä½é•¿æœŸæˆæœ¬
   æœ€ä½³æ¼”ç¤ºæ•ˆæœ
```

---

## 4. æ•´ä½“æ¶æ„è®¾è®¡

### 4.1 ç³»ç»Ÿæ¶æ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                              å‰ç«¯å±‚ (Vue 3 + TypeScript)                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                    ç¼–è¾‘å™¨è§†å›¾ç»„ä»¶ (SlideEditor.vue)                   â”‚   â”‚
â”‚  â”‚                                                                     â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚   â”‚
â”‚  â”‚  â”‚                    ç”»å¸ƒå®¹å™¨ (Canvas)                        â”‚    â”‚   â”‚
â”‚  â”‚  â”‚                                                             â”‚    â”‚   â”‚
â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚    â”‚   â”‚
â”‚  â”‚  â”‚  â”‚              èƒŒæ™¯å›¾ç‰‡å±‚ (åŸå§‹PPTå›¾ç‰‡)                â”‚   â”‚    â”‚   â”‚
â”‚  â”‚  â”‚  â”‚                                                     â”‚   â”‚    â”‚   â”‚
â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚    â”‚   â”‚
â”‚  â”‚  â”‚                           â”‚                                â”‚    â”‚   â”‚
â”‚  â”‚  â”‚                           â–¼                                â”‚    â”‚   â”‚
â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚    â”‚   â”‚
â”‚  â”‚  â”‚  â”‚           å åŠ æ–‡å­—æ¡†å±‚ (å¯ç¼–è¾‘å…ƒç´ )                  â”‚   â”‚    â”‚   â”‚
â”‚  â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚   â”‚    â”‚   â”‚
â”‚  â”‚  â”‚  â”‚  â”‚ æ–‡å­—æ¡†1  â”‚  â”‚ æ–‡å­—æ¡†2  â”‚  â”‚ æ–‡å­—æ¡†3  â”‚  ...     â”‚   â”‚    â”‚   â”‚
â”‚  â”‚  â”‚  â”‚  â”‚ (å¯ç¼–è¾‘) â”‚  â”‚ (å¯ç¼–è¾‘) â”‚  â”‚ (å¯ç¼–è¾‘) â”‚          â”‚   â”‚    â”‚   â”‚
â”‚  â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚   â”‚    â”‚   â”‚
â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚    â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚   â”‚
â”‚  â”‚                                                                     â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚   â”‚
â”‚  â”‚  â”‚                    å·¥å…·æ¡ (Toolbar)                         â”‚    â”‚   â”‚
â”‚  â”‚  â”‚  [è§£æå›¾ç‰‡] [é‡æ–°è§£æ]                                      â”‚    â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                    PPTè§£ææœåŠ¡ (imageParsingService.ts)             â”‚   â”‚
â”‚  â”‚  - parseSlideImage()     - getParsingStatus()                      â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                        â”‚
                                        â”‚ HTTP/WebSocket
                                        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                            APIç½‘å…³å±‚ (FastAPI)                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                   å›¾ç‰‡è§£æç«¯ç‚¹ (image_parsing.py)                     â”‚  â”‚
â”‚  â”‚                                                                       â”‚  â”‚
â”‚  â”‚  POST /api/v1/image_parsing/parse       è§£æå›¾ç‰‡ä¸­çš„æ–‡å­—             â”‚  â”‚
â”‚  â”‚  GET  /api/v1/image_parsing/status/{task_id}  æŸ¥è¯¢è§£æçŠ¶æ€           â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                        â”‚
                                        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                            æœåŠ¡å±‚ (Services)                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚   å›¾ç‰‡è§£ææœåŠ¡               â”‚    â”‚   ä»»åŠ¡ç®¡ç†æœåŠ¡                   â”‚   â”‚
â”‚   â”‚   (ImageParsingService)    â”‚    â”‚   (ParsingTaskManager)          â”‚   â”‚
â”‚   â”‚                            â”‚    â”‚                                 â”‚   â”‚
â”‚  â”‚ - parse_image()             â”‚    â”‚ - create_task()                 â”‚   â”‚
â”‚  â”‚ - process_ocr_result()      â”‚    â”‚ - update_status()               â”‚   â”‚
â”‚  â”‚ - format_text_regions()     â”‚    â”‚ - save_result()                 â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚                               â”‚
                    â–¼                               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      OCRå¼•æ“                  â”‚   â”‚         å­˜å‚¨å±‚                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                               â”‚   â”‚                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚   â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  è…¾è®¯äº‘OCR API          â”‚  â”‚   â”‚  â”‚ PostgreSQL  â”‚  â”‚    Redis      â”‚  â”‚
â”‚  â”‚  - æ–‡å­—æ£€æµ‹ä¸è¯†åˆ«        â”‚  â”‚   â”‚  â”‚             â”‚  â”‚               â”‚  â”‚
â”‚  â”‚  - é«˜ç²¾åº¦è¯†åˆ«(95%+)     â”‚  â”‚   â”‚  â”‚ - è§£æä»»åŠ¡  â”‚  â”‚ - ä»»åŠ¡çŠ¶æ€    â”‚  â”‚
â”‚  â”‚  - é›¶é…ç½®éƒ¨ç½²            â”‚  â”‚   â”‚  â”‚ - æ–‡å­—åŒºåŸŸ  â”‚  â”‚ - è§£æç»“æœ    â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚   â”‚  â”‚             â”‚  â”‚ - ç¼“å­˜æ•°æ®    â”‚  â”‚
â”‚                               â”‚   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                               â”‚   â”‚                                       â”‚
â”‚                               â”‚   â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚                               â”‚   â”‚  â”‚  è…¾è®¯äº‘COS                       â”‚  â”‚
â”‚                               â”‚   â”‚  â”‚  - åŸå§‹PPTå›¾ç‰‡                   â”‚  â”‚
â”‚                               â”‚   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                               â”‚   â”‚                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4.2 åˆ†å±‚æ¶æ„è¯´æ˜

#### 4.2.1 å‰ç«¯å±‚

**é‡è¦åŸåˆ™**ï¼šå¤ç”¨ç°æœ‰æˆç†Ÿç»„ä»¶ï¼Œé¿å…é‡å¤é€ è½®å­ã€‚

**å®é™…ç›®å½•ç»“æ„**ï¼ˆåŸºäºç°æœ‰ä»£ç ï¼‰ï¼š

```
frontend/src/
â”œâ”€â”€ views/
â”‚   â””â”€â”€ Editor/
â”‚       â”œâ”€â”€ index.vue                          # âœ… ç°æœ‰ - ä¸»ç¼–è¾‘å™¨å¸ƒå±€
â”‚       â”œâ”€â”€ Canvas/
â”‚       â”‚   â”œâ”€â”€ index.vue                      # âœ… ç°æœ‰ - ç”»å¸ƒå®¹å™¨ï¼ˆå·²æœ‰å…ƒç´ æ¸²æŸ“ï¼‰
â”‚       â”‚   â”œâ”€â”€ EditableElement.vue            # âœ… ç°æœ‰ - å…ƒç´ ç¼–è¾‘åŒ…è£…å™¨
â”‚       â”‚   â”œâ”€â”€ ViewportBackground.vue         # âœ… ç°æœ‰ - ç”»å¸ƒèƒŒæ™¯
â”‚       â”‚   â””â”€â”€ Operate/                       # âœ… ç°æœ‰ - å…ƒç´ æ“ä½œï¼ˆç¼©æ”¾ã€æ—‹è½¬ç­‰ï¼‰
â”‚       â”œâ”€â”€ CanvasTool/
â”‚       â”‚   â””â”€â”€ index.vue                      # âœ… ç°æœ‰ - ç”»å¸ƒå·¥å…·æ¡ï¼ˆæ’å…¥å…ƒç´ æŒ‰é’®ï¼‰
â”‚       â”œâ”€â”€ Toolbar/
â”‚       â”‚   â”œâ”€â”€ index.vue                      # âœ… ç°æœ‰ - å·¥å…·æ ï¼ˆéœ€æ·»åŠ è§£ææŒ‰é’®ï¼‰
â”‚       â”‚   â””â”€â”€ ElementStylePanel/             # âœ… ç°æœ‰ - å…ƒç´ æ ·å¼é¢æ¿
â”‚       â””â”€â”€ Thumbnails/
â”‚           â””â”€â”€ index.vue                      # âœ… ç°æœ‰ - å¹»ç¯ç‰‡ç¼©ç•¥å›¾
â”œâ”€â”€ services/
â”‚   â”œâ”€â”€ index.ts                               # âœ… ç°æœ‰ - ä¸»è¦APIæœåŠ¡
â”‚   â”œâ”€â”€ image.ts                               # âœ… ç°æœ‰ - å›¾ç‰‡ç›¸å…³æœåŠ¡
â”‚   â””â”€â”€ imageParsingService.ts                 # â­ æ–°å¢ - å›¾ç‰‡è§£ææœåŠ¡
â”œâ”€â”€ configs/
â”‚   â””â”€â”€ api.ts                                 # ğŸ”§ ä¿®æ”¹ - æ·»åŠ IMAGE_PARSINGç«¯ç‚¹
â”œâ”€â”€ types/
â”‚   â”œâ”€â”€ slides.ts                              # âœ… ç°æœ‰ - å¹»ç¯ç‰‡ç±»å‹å®šä¹‰
â”‚   â””â”€â”€ imageParsing.ts                        # â­ æ–°å¢ - å›¾ç‰‡è§£æç±»å‹å®šä¹‰
â””â”€â”€ store/
    â”œâ”€â”€ main.ts                                # ğŸ”§ ä¿®æ”¹ - æ·»åŠ è§£æçŠ¶æ€ç®¡ç†
    â””â”€â”€ slides.ts                              # âœ… ç°æœ‰ - å¹»ç¯ç‰‡çŠ¶æ€
```

**å›¾ä¾‹è¯´æ˜**ï¼š
- âœ… ç°æœ‰ - å·²æœ‰ä»£ç ï¼Œç›´æ¥å¤ç”¨
- ğŸ”§ ä¿®æ”¹ - éœ€è¦å°å¹…ä¿®æ”¹
- â­ æ–°å¢ - éœ€è¦æ–°å»º

**ç»„ä»¶å¤ç”¨ä¸å˜æ›´è¯´æ˜**ï¼š

| ç»„ä»¶/æ–‡ä»¶ | çŠ¶æ€ | è¯´æ˜ | å˜æ›´å†…å®¹ |
|----------|------|------|----------|
| `Editor/index.vue` | âœ… ç°æœ‰ | ä¸»ç¼–è¾‘å™¨å¸ƒå±€ | æ— éœ€ä¿®æ”¹ |
| `Canvas/index.vue` | âœ… ç°æœ‰ | ç”»å¸ƒå®¹å™¨ | æ— éœ€ä¿®æ”¹ï¼ˆå…ƒç´ æ’å…¥åè‡ªåŠ¨æ¸²æŸ“ï¼‰ |
| `Canvas/EditableElement.vue` | âœ… ç°æœ‰ | å…ƒç´ ç¼–è¾‘å™¨ | ç›´æ¥å¤ç”¨ï¼Œå·²æœ‰å®Œæ•´ç¼–è¾‘åŠŸèƒ½ |
| `Canvas/ViewportBackground.vue` | âœ… ç°æœ‰ | èƒŒæ™¯å±‚ | ç›´æ¥å¤ç”¨ |
| `CanvasTool/index.vue` | âœ… ç°æœ‰ | å·¥å…·æ¡ | æ— éœ€ä¿®æ”¹ |
| `Toolbar/index.vue` | ğŸ”§ ä¿®æ”¹ | å³ä¾§å·¥å…·æ  | æ·»åŠ "è§£æå›¾ç‰‡"æŒ‰é’® |
| `services/imageParsingService.ts` | â­ æ–°å¢ | è§£ææœåŠ¡ | æ–°å»ºï¼Œå°è£…OCR APIè°ƒç”¨ |
| `configs/api.ts` | ğŸ”§ ä¿®æ”¹ | APIé…ç½® | æ·»åŠ IMAGE_PARSINGç«¯ç‚¹ |
| `types/imageParsing.ts` | â­ æ–°å¢ | ç±»å‹å®šä¹‰ | æ–°å»ºï¼Œå®šä¹‰è§£æç›¸å…³ç±»å‹ |
| `store/main.ts` | ğŸ”§ ä¿®æ”¹ | çŠ¶æ€ç®¡ç† | æ·»åŠ è§£æçŠ¶æ€å­—æ®µ |

**æ ¸å¿ƒå®ç°è¦ç‚¹**ï¼š

1. **å¤ç”¨ç°æœ‰â€œå…ƒç´ ä½“ç³»â€å®ç°ç¼–è¾‘**ï¼š
   - OCR å®Œæˆåï¼Œå°†è¯†åˆ«ç»“æœè½¬æ¢ä¸ºçœŸå®å…ƒç´ å¹¶æ’å…¥å½“å‰ slide
   - åç»­ç¼–è¾‘å®Œå…¨å¤ç”¨ç°æœ‰æ¸²æŸ“/é€‰ä¸­/æ‹–æ‹½/ç¼©æ”¾/æ—‹è½¬/æ’¤é”€é‡åšé“¾è·¯

2. **é®ç½©ä¸ä½¿ç”¨ DOM è¦†ç›–å±‚**ï¼š
   - å¯¹æ¯ä¸ª OCR æ–‡æœ¬åŒºåŸŸåˆ›å»ºä¸€ä¸ªçŸ©å½¢ `shape` ä½œä¸ºé®ç½©ï¼ˆfill + opacityï¼‰
   - åˆ›å»ºä¸€ä¸ª `text` å…ƒç´ è¦†ç›–å…¶ä¸Š
   - ä¸¤è€…é€šè¿‡ `groupId` ç»‘å®šï¼Œç§»åŠ¨/ç¼©æ”¾/æ—‹è½¬å¤©ç„¶åŒæ­¥

3. **æœ€å°åŒ–æ–°å¢ä»£ç **ï¼š
   - `imageParsingService.ts`ï¼šå°è£… API è°ƒç”¨
   - å·¥å…·æ æŒ‰é’®ï¼šè§¦å‘è§£æä¸â€œè½¬ä¸ºå¯ç¼–è¾‘å…ƒç´ â€
   -ï¼ˆå¯é€‰ï¼‰åœ¨ `slidesStore.updateElement` æˆ–ç›¸å…³é€»è¾‘ä¸­åŠ å…¥â€œæ–‡æœ¬é«˜åº¦å˜åŒ–â†’åŒæ­¥é®ç½©é«˜åº¦â€çš„è½»é‡è”åŠ¨

**æœåŠ¡å°è£…** (`imageParsingService.ts` - æ–°å¢)ï¼š

```typescript
// frontend/src/services/imageParsingService.ts
import axios from 'axios'
import { API_CONFIG } from '@/configs/api'
import type { ImageParseResult, ParseTaskResponse, TextRegion } from '@/types/imageParsing'

export const imageParsingService = {
  /**
   * è§£æå›¾ç‰‡ä¸­çš„æ–‡å­—
   */
  async parseSlideImage(
    slideId: string,
    cosKey: string
  ): Promise<ParseTaskResponse> {
    const response = await axios.post(API_CONFIG.IMAGE_PARSING.PARSE, {
      slide_id: slideId,
      cos_key: cosKey
    })
    return response.data.data
  },

  /**
   * æŸ¥è¯¢è§£æçŠ¶æ€
   */
  async getParsingStatus(taskId: string): Promise<ImageParseResult> {
    const response = await axios.get(
      API_CONFIG.IMAGE_PARSING.STATUS(taskId)
    )
    return response.data.data
  }
}
```

**ç±»å‹å®šä¹‰** (`types/imageParsing.ts` - æ–°å¢)ï¼š

```typescript
// frontend/src/types/imageParsing.ts
export interface ParseTaskResponse {
  task_id: string
  status: 'pending' | 'processing' | 'completed' | 'failed'
  estimated_time: number
}

export interface BoundingBox {
  x: number
  y: number
  width: number
  height: number
}

export interface TextRegion {
  id: string
  text: string
  bbox: BoundingBox
  confidence: number
  font?: {
    size: number
    family: string
    weight: 'normal' | 'bold'
  }
}

export interface ImageParseResult {
  task_id: string
  slide_id: string
  cos_key: string
  status: 'pending' | 'processing' | 'completed' | 'failed'
  progress: number
  text_regions: TextRegion[]
  metadata: {
    parse_time: number
    ocr_engine: string
    text_count: number
    created_at: string
    completed_at?: string
  }
}
```

#### 4.2.2 APIç½‘å…³å±‚

**ç«¯ç‚¹å®šä¹‰** (`image_parsing.py`):

| ç«¯ç‚¹ | æ–¹æ³• | åŠŸèƒ½ |
|------|------|------|
| `/api/v1/image_parsing/parse` | POST | è§£æå›¾ç‰‡ä¸­çš„æ–‡å­— |
| `/api/v1/image_parsing/status/{task_id}` | GET | æŸ¥è¯¢è§£æçŠ¶æ€ |

#### 4.2.3 æœåŠ¡å±‚

1. **ImageParsingService** - æ ¸å¿ƒè§£ææœåŠ¡
   - è°ƒç”¨OCRå¼•æ“è¿›è¡Œæ–‡å­—è¯†åˆ«
   - å¤„ç†OCRç»“æœå¹¶æ ¼å¼åŒ–
   - æ„å»ºæ–‡å­—åŒºåŸŸæ•°æ®ç»“æ„

2. **ParsingTaskManager** - ä»»åŠ¡ç®¡ç†æœåŠ¡
   - åˆ›å»ºå’Œè·Ÿè¸ªè§£æä»»åŠ¡
   - ç®¡ç†ä»»åŠ¡çŠ¶æ€å’Œè¿›åº¦
   - ä¿å­˜å’Œç¼“å­˜è§£æç»“æœ

#### 4.2.4 å­˜å‚¨å±‚

- **PostgreSQL**: æŒä¹…åŒ–å­˜å‚¨è§£æä»»åŠ¡å’Œè§£æç»“æœ
- **Redis**: ç¼“å­˜è§£æçŠ¶æ€å’Œç»“æœï¼ˆæå‡æŸ¥è¯¢æ€§èƒ½ï¼‰
- **è…¾è®¯äº‘COS**: å­˜å‚¨åŸå§‹PPTå›¾ç‰‡

**æ³¨æ„**ï¼šå‰ç«¯â€œè½¬ä¸ºå¯ç¼–è¾‘å…ƒç´ â€åï¼Œå…ƒç´ ä¼šå†™å…¥ `slidesStore`ï¼ˆä¼šè¯å†…æŒä¹…ã€æ”¯æŒæ’¤é”€é‡åšï¼‰ï¼Œä½†**ä¸å›ä¼ åç«¯**ã€‚

---

## 5. æ ¸å¿ƒå®ç°æµç¨‹

### 5.1 å›¾ç‰‡è§£ææµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ç”¨æˆ·ç‚¹å‡»  â”‚ â†’ â”‚ å‰ç«¯è°ƒç”¨ â”‚ â†’ â”‚ åç«¯æ¥æ”¶ â”‚ â†’ â”‚ åˆ›å»ºä»»åŠ¡ â”‚ â†’ â”‚ ä¸‹è½½å›¾ç‰‡ â”‚
â”‚ è§£ææŒ‰é’®  â”‚   â”‚ APIæ¥å£  â”‚   â”‚ è¯·æ±‚     â”‚   â”‚ è¿”å›ID   â”‚   â”‚ åˆ°æœ¬åœ°   â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
     â”‚              â”‚              â”‚              â”‚              â”‚
     â”‚              â”‚              â–¼              â”‚              â”‚
     â”‚              â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚              â”‚
     â”‚              â”‚         â”‚ ä¿å­˜ä»»åŠ¡ â”‚        â”‚              â”‚
     â”‚              â”‚         â”‚ åˆ°æ•°æ®åº“ â”‚        â”‚              â”‚
     â”‚              â”‚         â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜        â”‚              â”‚
     â”‚              â”‚              â”‚              â”‚              â”‚
     â”‚              â”‚              â–¼              â”‚              â–¼
     â”‚              â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚              â”‚         â”‚ æäº¤å¼‚æ­¥ â”‚        â”‚    â”‚ è…¾è®¯äº‘OCR   â”‚
     â”‚              â”‚         â”‚ Celery   â”‚ â”€â”€â”€â”€â”€â”€â”¼â”€â”€â†’ â”‚ APIè°ƒç”¨     â”‚
     â”‚              â”‚         â”‚ ä»»åŠ¡     â”‚        â”‚    â”‚ æ–‡å­—æ£€æµ‹    â”‚
     â”‚              â”‚         â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜        â”‚    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
     â”‚              â”‚              â”‚              â”‚           â”‚
     â”‚              â”‚              â”‚              â”‚           â–¼
     â”‚              â”‚              â”‚              â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚              â”‚              â”‚              â”‚    â”‚ æ ¼å¼åŒ–ç»“æœ  â”‚
     â”‚              â”‚              â”‚              â”‚    â”‚ æ„å»ºæ–‡å­—åŒºåŸŸâ”‚
     â”‚              â”‚              â”‚              â”‚    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
     â”‚              â”‚              â”‚              â”‚           â”‚
     â”‚              â”‚              â–¼              â–¼           â–¼
     â”‚              â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚              â”‚         â”‚ ä¿å­˜ç»“æœåˆ°Redis             â”‚
     â”‚              â”‚         â”‚ æ›´æ–°ä»»åŠ¡çŠ¶æ€ä¸ºcompleted     â”‚
     â”‚              â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚              â”‚                        â”‚
     â”‚              â–¼                        â–¼
     â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚ å‰ç«¯è½®è¯¢è·å–è§£æç»“æœ               â”‚
               â”‚ æˆ–WebSocketæ¨é€                   â”‚
               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â–¼
                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                  â”‚ åœ¨å›¾ç‰‡ä¸Šå åŠ æ˜¾ç¤º     â”‚
                  â”‚ å¯ç¼–è¾‘æ–‡å­—æ¡†         â”‚
                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 5.2 æ•°æ®ç»“æ„å®šä¹‰

#### 5.2.1 æ–‡å­—åŒºåŸŸæ•°æ®ç»“æ„

```typescript
// è§£æç»“æœæ•°æ®ç»“æ„
interface ImageParseResult {
  taskId: string
  slideId: string
  imageUrl: string
  status: 'pending' | 'processing' | 'completed' | 'failed'
  progress: number  // 0-100
  textRegions: TextRegion[]
  metadata: ParseMetadata
}

// æ–‡å­—åŒºåŸŸ
interface TextRegion {
  id: string                    // å”¯ä¸€æ ‡è¯†
  text: string                  // è¯†åˆ«çš„æ–‡å­—å†…å®¹
  bbox: BoundingBox             // è¾¹ç•Œæ¡†åæ ‡
  confidence: number            // è¯†åˆ«ç½®ä¿¡åº¦ 0-1
  font?: FontInfo               // æ¨æ–­çš„å­—ä½“ä¿¡æ¯ï¼ˆå¯é€‰ï¼‰
}

// è¾¹ç•Œæ¡†åæ ‡
interface BoundingBox {
  x: number      // å·¦ä¸Šè§’Xåæ ‡ï¼ˆåƒç´ ï¼‰
  y: number      // å·¦ä¸Šè§’Yåæ ‡ï¼ˆåƒç´ ï¼‰
  width: number  // å®½åº¦ï¼ˆåƒç´ ï¼‰
  height: number // é«˜åº¦ï¼ˆåƒç´ ï¼‰
  // æˆ–è€…ä½¿ç”¨å››è§’åæ ‡
  points?: Point[]  // [[x1,y1], [x2,y2], [x3,y3], [x4,y4]]
}

interface Point {
  x: number
  y: number
}

// å­—ä½“ä¿¡æ¯ï¼ˆæ¨æ–­ï¼‰
interface FontInfo {
  size: number           // å­—ä½“å¤§å°ï¼ˆä¼°è®¡å€¼ï¼‰
  family: string        // å­—ä½“æ—ï¼ˆé»˜è®¤Microsoft YaHeiï¼‰
  weight: 'normal' | 'bold'  // å­—é‡
  color?: string        // å­—ä½“é¢œè‰²ï¼ˆå¦‚æœå¯æ£€æµ‹ï¼‰
}

// è§£æå…ƒæ•°æ®
interface ParseMetadata {
  parseTime: number      // è§£æè€—æ—¶ï¼ˆæ¯«ç§’ï¼‰
  ocrEngine: string     // OCRå¼•æ“åç§°
  textCount: number     // è¯†åˆ«çš„æ–‡å­—æ•°é‡
  createdAt: string     // åˆ›å»ºæ—¶é—´
  completedAt?: string  // å®Œæˆæ—¶é—´
}

// ä¿®æ”¹åçš„æ–‡å­—åŒºåŸŸ
interface ModifiedTextRegion extends TextRegion {
  originalText: string  // åŸå§‹æ–‡å­—ï¼ˆç”¨äºå¯¹æ¯”ï¼‰
  isModified: boolean   // æ˜¯å¦è¢«ä¿®æ”¹è¿‡
  modifiedAt?: string   // ä¿®æ”¹æ—¶é—´
}
```

#### 5.2.2 åç«¯æ•°æ®æ¨¡å‹

```python
from pydantic import BaseModel
from typing import List, Optional
from datetime import datetime

class BoundingBox(BaseModel):
    """è¾¹ç•Œæ¡†åæ ‡"""
    x: int
    y: int
    width: int
    height: int

class FontInfo(BaseModel):
    """å­—ä½“ä¿¡æ¯"""
    size: int
    family: str = "Microsoft YaHei"
    weight: str = "normal"
    color: Optional[str] = None

class TextRegion(BaseModel):
    """æ–‡å­—åŒºåŸŸ"""
    id: str
    text: str
    bbox: BoundingBox
    confidence: float
    font: Optional[FontInfo] = None

class ParseMetadata(BaseModel):
    """è§£æå…ƒæ•°æ®"""
    parse_time: int
    ocr_engine: str
    text_count: int
    created_at: datetime
    completed_at: Optional[datetime] = None

class ImageParseResult(BaseModel):
    """å›¾ç‰‡è§£æç»“æœ"""
    task_id: str
    slide_id: str
    cos_key: str
    status: str
    progress: int
    text_regions: List[TextRegion]
    metadata: ParseMetadata

class ParseRequest(BaseModel):
    """è§£æè¯·æ±‚"""
    slide_id: str
    cos_key: str
    options: Optional[ParseOptions] = None

class ParseOptions(BaseModel):
    """è§£æé€‰é¡¹ï¼ˆMVPé˜¶æ®µä½¿ç”¨è…¾è®¯äº‘OCRï¼Œé¢„ç•™æ‰©å±•ï¼‰"""
    # MVPé˜¶æ®µä½¿ç”¨è…¾è®¯äº‘OCRï¼Œæ— éœ€ä¼ é€’é¢å¤–å‚æ•°
    # æœªæ¥å¯æ‰©å±•ï¼šlanguage, detect_tables ç­‰é€‰é¡¹
```

### 5.3 APIæ¥å£å®šä¹‰

#### 5.3.1 è§£æå›¾ç‰‡

**è¯·æ±‚**:

```http
POST /api/v1/image_parsing/parse
Content-Type: application/json
Authorization: Bearer <token>

{
  "slide_id": "banana_task_xxx_slide_0",
  "cos_key": "ai-generated/ppt/xxx/slide_0.png"
}
```

**è¯´æ˜**ï¼š
- MVPé˜¶æ®µä½¿ç”¨è…¾è®¯äº‘OCR APIï¼Œæ— éœ€ä¼ é€’ `options` å‚æ•°
- åç«¯è‡ªåŠ¨è°ƒç”¨è…¾è®¯äº‘OCRè¿›è¡Œæ–‡å­—è¯†åˆ«
- æœªæ¥æ‰©å±•å¯æ”¯æŒ options å‚æ•°ï¼ˆå¦‚å¤šè¯­è¨€ã€è¡¨æ ¼æ£€æµ‹ç­‰ï¼‰
- **è¾“å…¥çº¦æŸ**ï¼šä¼˜å…ˆä½¿ç”¨ `cos_key`ï¼ˆæˆ–å—æ§çš„å†…éƒ¨èµ„æº IDï¼‰ï¼Œç”±åç«¯é€šè¿‡ COS SDK è·å–å›¾ç‰‡å†…å®¹ï¼Œé¿å…ç›´æ¥ä¸‹è½½ä»»æ„ URL

**å“åº”**:

```http
HTTP/1.1 200 OK
Content-Type: application/json

{
  "code": 0,
  "message": "è§£æä»»åŠ¡å·²åˆ›å»º",
  "data": {
    "task_id": "parse_20241224_123456_abc123",
    "status": "pending",
    "estimated_time": 5,
    "message": "ä»»åŠ¡å·²æäº¤ï¼Œæ­£åœ¨å¤„ç†ä¸­"
  },
  "timestamp": "2024-12-24T12:34:56Z",
  "request_id": "req_abc123"
}
```

#### 5.3.2 æŸ¥è¯¢è§£æçŠ¶æ€

**è¯·æ±‚**:

```http
GET /api/v1/image_parsing/status/parse_20241224_123456_abc123
Authorization: Bearer <token>
```

**å¤„ç†ä¸­å“åº”**:

```http
HTTP/1.1 200 OK
Content-Type: application/json

{
  "code": 0,
  "message": "æ­£åœ¨å¤„ç†",
  "data": {
    "task_id": "parse_20241224_123456_abc123",
    "status": "processing",
    "progress": 65,
    "current_step": "ocr_recognition",
    "message": "æ­£åœ¨è¿›è¡Œæ–‡å­—è¯†åˆ«..."
  },
  "timestamp": "2024-12-24T12:35:00Z",
  "request_id": "req_def456"
}
```

**å®Œæˆå“åº”**:

```http
HTTP/1.1 200 OK
Content-Type: application/json

{
  "code": 0,
  "message": "è§£æå®Œæˆ",
  "data": {
    "task_id": "parse_20241224_123456_abc123",
    "slide_id": "banana_task_xxx_slide_0",
    "cos_key": "ai-generated/ppt/xxx/slide_0.png",
    "status": "completed",
    "progress": 100,
    "text_regions": [
      {
        "id": "region_001",
        "text": "äººå·¥æ™ºèƒ½æŠ€æœ¯å‘å±•ç°çŠ¶",
        "bbox": {
          "x": 250,
          "y": 80,
          "width": 500,
          "height": 60
        },
        "confidence": 0.98,
        "font": {
          "size": 42,
          "family": "Microsoft YaHei",
          "weight": "bold"
        }
      },
      {
        "id": "region_002",
        "text": "äººå·¥æ™ºèƒ½æŠ€æœ¯æ­£åœ¨å¿«é€Ÿå‘å±•ï¼Œå¹¿æ³›åº”ç”¨äºå„ä¸ªé¢†åŸŸã€‚",
        "bbox": {
          "x": 100,
          "y": 180,
          "width": 800,
          "height": 45
        },
        "confidence": 0.95,
        "font": {
          "size": 24,
          "family": "Microsoft YaHei",
          "weight": "normal"
        }
      },
      {
        "id": "region_003",
        "text": "åº”ç”¨é¢†åŸŸåŒ…æ‹¬ï¼šåŒ»ç–—ã€é‡‘èã€æ•™è‚²ã€äº¤é€šç­‰ã€‚",
        "bbox": {
          "x": 100,
          "y": 250,
          "width": 800,
          "height": 45
        },
        "confidence": 0.96,
        "font": {
          "size": 24,
          "family": "Microsoft YaHei",
          "weight": "normal"
        }
      }
    ],
    "metadata": {
      "parse_time": 3200,
      "ocr_engine": "tencent_ocr",
      "text_count": 3,
      "created_at": "2024-12-24T12:34:56Z",
      "completed_at": "2024-12-24T12:35:00Z"
    }
  },
  "timestamp": "2024-12-24T12:35:01Z",
  "request_id": "req_xyz789"
}
```

### 5.4 å‰ç«¯æ¸²æŸ“æµç¨‹

#### 5.4.1 æ ¸å¿ƒæ–¹æ¡ˆï¼šOCR ç»“æœâ€œå…ƒç´ åŒ–æ’å…¥â€ï¼ˆé®ç½© Shape + Text ç»„åˆï¼‰

**è®¾è®¡åŸåˆ™**ï¼šæœ€å¤§åŒ–å¤ç”¨ç°æœ‰æˆç†Ÿâ€œå…ƒç´ ä½“ç³»â€ï¼Œé¿å…æ–°å¢ä¸€å¥—å¹³è¡Œæ¸²æŸ“/äº¤äº’é“¾è·¯ã€‚

**å‰æçº¦æŸ / åè®®ï¼ˆå¿…é¡»æ»¡è¶³ï¼Œä¿è¯åæ ‡å¯æ¨å¯¼ï¼‰**ï¼š
- **èƒŒæ™¯å›¾æ¯”ä¾‹ä¸€è‡´**ï¼šç”Ÿæˆçš„ slide èƒŒæ™¯å›¾å®½é«˜æ¯”å¿…é¡»ä¸ç¼–è¾‘å™¨ç”»å¸ƒä¸€è‡´ï¼ˆé»˜è®¤ `viewportRatio = 16:9`ï¼‰ã€‚
- **èƒŒæ™¯æ¸²æŸ“å¯æ¨å¯¼æ˜ å°„**ï¼šèƒŒæ™¯å›¾æ¸²æŸ“å¿…é¡»ä¸å‘ç”Ÿè£å‰ªï¼Œæ¨èå›ºå®šä¸º `background-size: 100% 100%`ï¼›æˆ–ç¡®ä¿ `cover` åœºæ™¯ä¸ä¼šè£å‰ªï¼ˆå³å›¾ç‰‡æ¯”ä¾‹ä¸¥æ ¼ä¸€è‡´ï¼‰ã€‚
- **MVP åˆ†è¾¨ç‡çº¦å®šï¼ˆæ¨èï¼‰**ï¼šé¦™è•‰ç”Ÿæˆçš„æ¯é¡µå›¾ç‰‡å›ºå®šä¸º `1920x1080`ï¼ˆ16:9ï¼‰ã€‚è¿™æ ·å‰ç«¯å¯ä»¥æ— éœ€ä¾èµ–é¢å¤–å…ƒæ•°æ®å³å¯æ¢ç®— bbox â†’ å¹»ç¯ç‰‡åæ ‡ã€‚

**æ–¹æ¡ˆæ¦‚è¿°**ï¼š
- OCR è¿”å› `TextRegion[]`ï¼ˆåŒ…å« `bbox`ï¼‰
- å‰ç«¯æŠŠ `bbox` è½¬æˆå¹»ç¯ç‰‡åæ ‡ç³»çš„ `left/top/width/height`
- å¯¹æ¯ä¸ªåŒºåŸŸæ’å…¥ä¸¤ä¸ªçœŸå®å…ƒç´ ï¼š
  - **é®ç½©å…ƒç´ **ï¼šçŸ©å½¢ `shape`ï¼Œç”¨äºé®è”½åŸå›¾æ–‡å­—ï¼ˆ`fill + opacity`ï¼‰
  - **æ–‡å­—å…ƒç´ **ï¼š`text`ï¼Œè¦†ç›–åœ¨é®ç½©ä¸Šæ–¹
- ä¸¤ä¸ªå…ƒç´ å…±äº«åŒä¸€ `groupId`ï¼Œç§»åŠ¨/ç¼©æ”¾/æ—‹è½¬å¤©ç„¶åŒæ­¥

**å±‚çº§å…³ç³»ï¼ˆç”±å…ƒç´ é¡ºåºè‡ªç„¶ä¿è¯ï¼‰**ï¼š
- åŒä¸€ç»„å†…ï¼šå…ˆæ’å…¥é®ç½© shapeï¼Œå†æ’å…¥ textï¼ˆç¡®ä¿ text åœ¨ä¸Šå±‚ï¼‰

#### 5.4.2 å…³é”®å®ç°ï¼šbbox â†’ å…ƒç´ æ’å…¥ + groupId ç»‘å®š

**åæ ‡æ¢ç®—ï¼ˆåŸºäºåè®® 1920x1080 ä¸ç”»å¸ƒ viewportSize/viewportRatioï¼‰**ï¼š

```
viewportWidth  = slidesStore.viewportSize
viewportHeight = slidesStore.viewportSize * slidesStore.viewportRatio

scaleX = viewportWidth  / 1920
scaleY = viewportHeight / 1080

left   = bbox.x      * scaleX
top    = bbox.y      * scaleY
width  = bbox.width  * scaleX
height = bbox.height * scaleY
```

**å…ƒç´ æ’å…¥ç¤ºä¾‹ï¼ˆæ ¸å¿ƒæ€è·¯ï¼Œå¤ç”¨ç°æœ‰ç±»å‹ä¸æ¸²æŸ“é“¾è·¯ï¼‰**ï¼š

```typescript
import { nanoid } from 'nanoid'
import { useMainStore, useSlidesStore } from '@/store'
import type { PPTShapeElement, PPTTextElement } from '@/types/slides'
import type { TextRegion } from '@/types/imageParsing'

// ä½¿ç”¨ configs/shapes.ts ä¸­â€œçŸ©å½¢â€shape çš„ path/viewBox
const RECT_SHAPE = {
  viewBox: [200, 200] as [number, number],
  path: 'M 0 0 L 200 0 L 200 200 L 0 200 Z',
}

const OCR_IMAGE_WIDTH = 1920
const OCR_IMAGE_HEIGHT = 1080

export function insert_ocr_regions_as_elements(regions: TextRegion[], taskId: string) {
  const mainStore = useMainStore()
  const slidesStore = useSlidesStore()
  const slide = slidesStore.currentSlide
  if (!slide) return

  const viewportWidth = slidesStore.viewportSize
  const viewportHeight = slidesStore.viewportSize * slidesStore.viewportRatio
  const scaleX = viewportWidth / OCR_IMAGE_WIDTH
  const scaleY = viewportHeight / OCR_IMAGE_HEIGHT

  for (const region of regions) {
    const groupId = `ocr_group_${taskId}_${region.id}`
    const left = region.bbox.x * scaleX
    const top = region.bbox.y * scaleY
    const width = region.bbox.width * scaleX
    const height = region.bbox.height * scaleY

    const maskId = `ocr_mask_${taskId}_${region.id}`
    const textId = `ocr_text_${taskId}_${region.id}`

    // 1) é®ç½© shapeï¼ˆå…ˆæ’å…¥ï¼Œä¿è¯ä½äº text ä¸‹æ–¹ï¼‰
    const maskEl: PPTShapeElement = {
      type: 'shape',
      id: maskId,
      groupId,
      left, top, width, height,
      rotate: 0,
      viewBox: RECT_SHAPE.viewBox,
      path: RECT_SHAPE.path,
      fixedRatio: false,
      fill: '#ffffff',
      opacity: 0.85,
      outline: { width: 0, color: 'transparent' },
    }

    // 2) æ–‡å­— textï¼ˆè¦†ç›–åœ¨é®ç½©ä¹‹ä¸Šï¼‰
    const textEl: PPTTextElement = {
      type: 'text',
      id: textId,
      groupId,
      left, top, width, height,
      rotate: 0,
      content: region.text,
      defaultFontName: region.font?.family || slidesStore.theme.fontName,
      defaultColor: '#000000',
    }

    slidesStore.addElement(maskEl)
    slidesStore.addElement(textEl)
  }

  // è®©ç”¨æˆ·ç«‹åˆ»èƒ½æ“ä½œï¼ˆå¯æŒ‰éœ€é€‰ä¸­æ•´ç»„æˆ–æœ€åä¸€ä¸ªå…ƒç´ ï¼‰
  // è¿™é‡Œä»…ç¤ºæ„ï¼šå®é™…å¯æ ¹æ®äº¤äº’æŠŠ activeElementIdList è®¾ä¸ºæŸä¸ª textId æˆ–æ•´ç»„å…ƒç´ IDåˆ—è¡¨
  mainStore.setActiveElementIdList([])
}
```

#### 5.4.3 æ–‡æœ¬é«˜åº¦å˜åŒ– â†’ åŒæ­¥é®ç½©ï¼ˆè½»é‡è”åŠ¨ï¼‰

**é—®é¢˜**ï¼šç°æœ‰ `TextElement` ä¼šæ ¹æ®å†…å®¹è‡ªåŠ¨æ›´æ–° `height`ï¼ˆResizeObserver + `slidesStore.updateElement`ï¼‰ã€‚å¦‚æœé®ç½©é«˜åº¦ä¸è·Ÿéšï¼Œä¼šéœ²å‡ºåŸå›¾æ–‡å­—ã€‚

**å»ºè®®ç­–ç•¥ï¼ˆä¸å¼•å…¥æ–°æ¸²æŸ“å±‚ï¼‰**ï¼š
- çº¦å®š OCR å…ƒç´  ID å‘½åï¼š`ocr_text_${taskId}_${regionId}` ä¸ `ocr_mask_${taskId}_${regionId}`
- åœ¨ `slidesStore.updateElement(...)`ï¼ˆæˆ–å…¶è°ƒç”¨é“¾çš„ä¸€ä¸ªé›†ä¸­ä½ç½®ï¼‰å¢åŠ ä¸€æ®µè½»é‡é€»è¾‘ï¼š
  - å½“æ›´æ–°çš„æ˜¯ `ocr_text_...` ä¸” `height`/`width` å‘ç”Ÿå˜åŒ–æ—¶
  - åŒæ­¥æ›´æ–°å¯¹åº” `ocr_mask_...` çš„ `height`/`width`ï¼ˆå¿…è¦æ—¶ä¹Ÿå¯åŒæ­¥ `left/top`ï¼‰

**å®Œæ•´æ•°æ®æµï¼ˆæ›´æ–°ç‰ˆï¼‰**ï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. ç”¨æˆ·ç‚¹å‡»    â”‚
â”‚    "è§£æå›¾ç‰‡"  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2. å‰ç«¯è°ƒç”¨ API               â”‚ â† imageParsingService.parseSlideImage(slideId, cosKey)
â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3. åç«¯é€šè¿‡ COS SDK è·å–å›¾ç‰‡ bytes        â”‚
â”‚    + OCR è¯†åˆ«ï¼Œäº§å‡º TextRegion[]          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 4. å‰ç«¯æ‹¿åˆ° TextRegion[]                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â–¼ï¼ˆç”¨æˆ·ç¡®è®¤/ä¸€é”®è½¬æ¢ï¼‰
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 5. bbox â†’ å¹»ç¯ç‰‡åæ ‡ï¼Œæ’å…¥çœŸå®å…ƒç´          â”‚
â”‚    - mask: shapeï¼ˆé®ç½©ï¼‰                   â”‚
â”‚    - text: textï¼ˆå¯ç¼–è¾‘ï¼‰                  â”‚
â”‚    - groupId ç»‘å®š                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 6. å¤ç”¨ç°æœ‰æ¸²æŸ“ä¸äº¤äº’é“¾è·¯                  â”‚
â”‚    - EditableElement/TextElement æ¸²æŸ“       â”‚
â”‚    - æ‹–æ‹½/ç¼©æ”¾/æ—‹è½¬/æ’¤é”€é‡åš                â”‚
â”‚    - æ–‡æœ¬è‡ªé€‚åº”é«˜åº¦ + åŒæ­¥é®ç½©              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 6. åç«¯å®ç°

### 6.1 è…¾è®¯äº‘ OCR API é›†æˆï¼ˆMVP é¦–é€‰ï¼‰

#### 6.1.1 å‡†å¤‡å·¥ä½œ

**æ­¥éª¤1ï¼šæ³¨å†Œè…¾è®¯äº‘å¹¶å¼€é€šOCRæœåŠ¡ï¼ˆ5åˆ†é’Ÿï¼‰**

```bash
# 1. æ³¨å†Œè…¾è®¯äº‘è´¦å·
https://cloud.tencent.com/

# 2. å¼€é€šOCRæœåŠ¡ï¼ˆè‡ªåŠ¨å¼€é€šï¼Œæ— éœ€å®¡æ ¸ï¼‰
https://cloud.tencent.com/product/ocr

# 3. è·å–APIå¯†é’¥
æ§åˆ¶å° -> è®¿é—®å¯†é’¥ -> APIå¯†é’¥ -> æ–°å»ºå¯†é’¥
# è®°å½• SecretId å’Œ SecretKey
```

**æ­¥éª¤2ï¼šé…ç½®ç¯å¢ƒå˜é‡**

```bash
# backend/.env
TENCENT_OCR_SECRET_ID=AKIDxxxxxxxxxxxxxxxxxxxxxxxxxxxx
TENCENT_OCR_SECRET_KEY=xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
TENCENT_OCR_REGION=ap-guangzhou
```

#### 6.1.2 OCR å¼•æ“å®ç°ï¼ˆä½¿ç”¨SDKï¼‰

è…¾è®¯äº‘æä¾›Python SDKï¼Œç­¾åè‡ªåŠ¨å¤„ç†ï¼Œæ— éœ€æ‰‹åŠ¨å®ç°å¤æ‚çš„ç­¾åç®—æ³•ï¼š

```bash
pip install tencentcloud-sdk-python
```

```python
# backend/app/services/ocr/tencent_ocr_sdk_engine.py
from tencentcloud.common import credential
from tencentcloud.ocr.v20181119 import ocr_client, models
from typing import List, Dict
import os

class TencentOCRSDKEngine:
    """è…¾è®¯äº‘OCRå¼•æ“ - SDKç‰ˆæœ¬ï¼ˆæ›´ç®€å•ï¼‰"""

    def __init__(self):
        # ä½¿ç”¨SDKï¼Œç­¾åè‡ªåŠ¨å¤„ç†
        secret_id = os.getenv("TENCENT_OCR_SECRET_ID")
        secret_key = os.getenv("TENCENT_OCR_SECRET_KEY")
        region = os.getenv("TENCENT_OCR_REGION", "ap-guangzhou")

        cred = credential.Credential(secret_id, secret_key)
        self.client = ocr_client.OcrClient(cred, region)

    async def parse_from_cos_key(self, cos_key: str) -> List[Dict]:
        """ä»COS Keyè§£æå›¾ç‰‡ï¼ˆæ¨èï¼šé¿å…ä¸‹è½½ä»»æ„URLï¼‰"""
        import base64
        from app.core.storage import get_storage_service

        # é€šè¿‡ç»Ÿä¸€å­˜å‚¨æœåŠ¡ä» COS æ‹‰å–å›¾ç‰‡ bytes
        storage = get_storage_service()
        download_result = await storage.download(cos_key)
        img_base64 = base64.b64encode(download_result.data).decode()

        # è°ƒç”¨APIï¼ˆé€šç”¨å°åˆ·ä½“è¯†åˆ«ï¼‰
        req = models.GeneralBasicOCRRequest()
        req.ImageBase64 = img_base64

        resp = self.client.GeneralBasicOCR(req)

        # æ ¼å¼åŒ–ç»“æœ
        formatted = []
        for item in resp.TextDetections:
            polygon = item.Polygon
            if polygon:
                bbox = {
                    "x": int(min(p.X for p in polygon)),
                    "y": int(min(p.Y for p in polygon)),
                    "width": int(max(p.X for p in polygon) - min(p.X for p in polygon)),
                    "height": int(max(p.Y for p in polygon) - min(p.Y for p in polygon))
                }
            else:
                bbox = {
                    "x": item.ItemCoord.X,
                    "y": item.ItemCoord.Y,
                    "width": item.ItemCoord.Width,
                    "height": item.ItemCoord.Height
                }

            formatted.append({
                "text": item.DetectedText,
                "bbox": bbox,
                "confidence": item.Confidence / 100 if item.Confidence else 0.95
            })

        return formatted
```

#### 6.1.3 å¿«é€Ÿæµ‹è¯•

```python
# test_ocr.py
import os
from app.services.ocr.tencent_ocr_sdk_engine import TencentOCRSDKEngine

# æµ‹è¯•ï¼ˆç¤ºä¾‹ï¼‰
import asyncio

engine = TencentOCRSDKEngine()
result = asyncio.run(engine.parse_from_cos_key("ai-generated/ppt/xxx/slide_0.png"))

for item in result:
    print(f"æ–‡å­—: {item['text']}")
    print(f"ä½ç½®: {item['bbox']}")
    print(f"ç½®ä¿¡åº¦: {item['confidence']}")
    print("---")
```

#### 6.1.4 å›¾ç‰‡è§£ææœåŠ¡

```python
# backend/app/services/parsing/image_parsing_service.py
from typing import List, Dict, Optional
from datetime import datetime
import uuid
import asyncio
from sqlalchemy.ext.asyncio import AsyncSession

from app.services.ocr.tencent_ocr_sdk_engine import TencentOCRSDKEngine
from app.models.schemas.image_parsing import (
    TextRegion, ParseRequest, ParseResult, ParseMetadata
)
from app.repositories.image_parsing_repository import ImageParsingRepository


class ImageParsingService:
    """å›¾ç‰‡è§£ææœåŠ¡"""

    def __init__(self, db: AsyncSession):
        self.db = db
        self.repo = ImageParsingRepository(db)
        self.ocr_engine = None

    def _get_ocr_engine(self, options: Optional[Dict] = None) -> TencentOCRSDKEngine:
        """è·å– OCR å¼•æ“å®ä¾‹ï¼ˆMVP: è…¾è®¯äº‘OCRï¼‰"""
        if self.ocr_engine is None:
            self.ocr_engine = TencentOCRSDKEngine()
        return self.ocr_engine

    async def parse_image(
        self,
        slide_id: str,
        cos_key: str,
        options: Optional[Dict] = None,
        user_id: Optional[str] = None
    ) -> ParseResult:
        """è§£æå›¾ç‰‡ä¸­çš„æ–‡å­—"""
        start_time = datetime.now()
        task_id = f"parse_{datetime.now().strftime('%Y%m%d_%H%M%S')}_{uuid.uuid4().hex[:8]}"

        # åˆ›å»ºä»»åŠ¡è®°å½•
        await self.repo.create_task(
            task_id=task_id,
            slide_id=slide_id,
            cos_key=cos_key,
            user_id=user_id,
            status="processing"
        )

        try:
            # è·å– OCR å¼•æ“
            ocr_engine = self._get_ocr_engine(options)

            # æ‰§è¡Œ OCR è¯†åˆ«ï¼ˆCOS Key â†’ bytes â†’ OCRï¼‰
            ocr_results = await ocr_engine.parse_from_cos_key(cos_key)

            # æ„å»ºæ–‡å­—åŒºåŸŸæ•°æ®
            text_regions = []
            for idx, result in enumerate(ocr_results):
                region_id = f"region_{idx + 1:03d}"

                text_region = TextRegion(
                    id=region_id,
                    text=result["text"],
                    bbox=result["bbox"],
                    confidence=result["confidence"],
                    font={
                        "size": self._infer_font_size(result["bbox"]),
                        "family": "Microsoft YaHei",
                        "weight": self._infer_font_weight(result)
                    }
                )
                text_regions.append(text_region)

            # è®¡ç®—è§£æè€—æ—¶
            parse_time = int((datetime.now() - start_time).total_seconds() * 1000)

            # æ„å»ºå…ƒæ•°æ®
            metadata = ParseMetadata(
                parse_time=parse_time,
                ocr_engine="tencent_ocr",
                text_count=len(text_regions),
                created_at=start_time,
                completed_at=datetime.now()
            )

            # æ›´æ–°ä»»åŠ¡çŠ¶æ€
            await self.repo.update_task_status(
                task_id=task_id,
                status="completed",
                text_regions=[r.dict() for r in text_regions],
                metadata=metadata.dict()
            )

            return ParseResult(
                task_id=task_id,
                slide_id=slide_id,
                cos_key=cos_key,
                status="completed",
                progress=100,
                text_regions=text_regions,
                metadata=metadata
            )

        except Exception as e:
            await self.repo.update_task_status(
                task_id=task_id,
                status="failed",
                error_message=str(e)
            )
            raise

    def _infer_font_size(self, bbox: Dict) -> int:
        """æ¨æ–­å­—ä½“å¤§å°"""
        estimated_size = int(bbox["height"] * 0.75)
        return max(12, min(72, estimated_size))

    def _infer_font_weight(self, result: Dict) -> str:
        """æ¨æ–­å­—é‡"""
        text = result.get("text", "")
        bbox = result.get("bbox", {})
        if len(text) < 20 and bbox.get("height", 0) > 40:
            return "bold"
        return "normal"
```

---

## 7. æ•°æ®åº“è®¾è®¡

### 7.1 è§£æä»»åŠ¡è¡¨

```sql
-- è§£æä»»åŠ¡è¡¨
CREATE TABLE image_parse_tasks (
    id VARCHAR(50) PRIMARY KEY,                    -- ä»»åŠ¡ID
    slide_id VARCHAR(100) NOT NULL,                -- å…³è”çš„å¹»ç¯ç‰‡ID
    cos_key TEXT NOT NULL,                         -- åŸå§‹å›¾ç‰‡COS Keyï¼ˆå—æ§è¾“å…¥ï¼‰
    status parse_task_status NOT NULL,             -- ä»»åŠ¡çŠ¶æ€
    progress INTEGER DEFAULT 0,                    -- è¿›åº¦ 0-100

    -- è§£æé€‰é¡¹
    parse_options JSONB,                           -- è§£æé€‰é¡¹é…ç½®

    -- è§£æç»“æœ
    text_regions JSONB,                            -- è§£æå‡ºçš„æ–‡å­—åŒºåŸŸ
    metadata JSONB,                                -- è§£æå…ƒæ•°æ®

    -- æ—¶é—´æˆ³
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
    started_at TIMESTAMP WITH TIME ZONE,
    completed_at TIMESTAMP WITH TIME ZONE,

    -- é”™è¯¯ä¿¡æ¯
    error_message TEXT,

    -- ç”¨æˆ·å…³è”
    user_id VARCHAR(50),

    -- å¤–é”®
    FOREIGN KEY (user_id) REFERENCES users(id)
);

-- ä»»åŠ¡çŠ¶æ€æšä¸¾
CREATE TYPE parse_task_status AS ENUM (
    'pending',      -- ç­‰å¾…å¤„ç†
    'downloading',  -- ä¸‹è½½å›¾ç‰‡ä¸­
    'processing',   -- è§£æå¤„ç†ä¸­
    'completed',    -- è§£æå®Œæˆ
    'failed'        -- è§£æå¤±è´¥
);

-- ç´¢å¼•
CREATE INDEX idx_parse_tasks_slide_id ON image_parse_tasks(slide_id);
CREATE INDEX idx_parse_tasks_user_id ON image_parse_tasks(user_id);
CREATE INDEX idx_parse_tasks_status ON image_parse_tasks(status);
CREATE INDEX idx_parse_tasks_created_at ON image_parse_tasks(created_at DESC);

-- æ³¨é‡Š
COMMENT ON TABLE image_parse_tasks IS 'å›¾ç‰‡è§£æä»»åŠ¡è¡¨';
COMMENT ON COLUMN image_parse_tasks.text_regions IS 'è§£æå‡ºçš„æ–‡å­—åŒºåŸŸï¼ŒåŒ…å«æ–‡å­—å†…å®¹ã€ä½ç½®ã€ç½®ä¿¡åº¦ç­‰ä¿¡æ¯';
```

### 7.2 Redis ç¼“å­˜è®¾è®¡

```python
# ä»»åŠ¡çŠ¶æ€ç¼“å­˜ï¼ˆTTL: 1å°æ—¶ï¼‰
Key: image:parse:task:{task_id}
Value: {
    "task_id": "parse_20241224_123456_abc123",
    "status": "processing",
    "progress": 65,
    "current_step": "ocr_recognition",
    "slide_id": "banana_xxx_slide_0",
    "created_at": "2024-12-24T12:34:56Z"
}

# è§£æç»“æœç¼“å­˜ï¼ˆTTL: 24å°æ—¶ï¼‰
Key: image:parse:result:{task_id}
Value: {
    "task_id": "parse_20241224_123456_abc123",
    "slide_id": "banana_xxx_slide_0",
    "cos_key": "ai-generated/ppt/xxx/slide_0.png",
    "status": "completed",
    "progress": 100,
    "text_regions": [
        {
            "id": "region_001",
            "text": "äººå·¥æ™ºèƒ½æŠ€æœ¯å‘å±•ç°çŠ¶",
            "bbox": {"x": 250, "y": 80, "width": 500, "height": 60},
            "confidence": 0.98,
            "font": {"size": 42, "family": "Microsoft YaHei", "weight": "bold"}
        },
        ...
    ],
    "metadata": {
        "parse_time": 3200,
        "ocr_engine": "paddleocr",
        "text_count": 3,
        "created_at": "2024-12-24T12:34:56Z",
        "completed_at": "2024-12-24T12:35:00Z"
    }
}

# å¹»ç¯ç‰‡è§£æçŠ¶æ€æ±‡æ€»ï¼ˆTTL: 1å°æ—¶ï¼‰
Key: image:parse:slides:{slide_id}
Value: {
    "slide_id": "banana_xxx_slide_0",
    "is_parsed": true,
    "text_count": 3,
    "task_id": "parse_20241224_123456_abc123",
    "parsed_at": "2024-12-24T12:35:00Z"
}
```

---

## 8. API ç«¯ç‚¹å®ç°

### 8.1 ç«¯ç‚¹å®šä¹‰

```python
# backend/app/api/v1/endpoints/image_parsing.py
from fastapi import APIRouter, Depends, HTTPException
from sqlalchemy.ext.asyncio import AsyncSession

from app.api.dependencies import get_db, get_current_user_id
from app.models.schemas.image_parsing import (
    ParseRequest, ParseTaskResponse, ParseStatusResponse
)
from app.services.parsing.image_parsing_service import ImageParsingService
from app.core.standard_response import StandardResponse

router = APIRouter()


@router.post("/parse", response_model=StandardResponse[ParseTaskResponse])
async def parse_image(
    request: ParseRequest,
    db: AsyncSession = Depends(get_db),
    user_id: str = Depends(get_current_user_id)
):
    """
    è§£æå›¾ç‰‡ä¸­çš„æ–‡å­—

    æäº¤å›¾ç‰‡è§£æä»»åŠ¡ï¼Œè¿”å›ä»»åŠ¡IDã€‚å‰ç«¯éœ€è¦è½®è¯¢æŸ¥è¯¢ä»»åŠ¡çŠ¶æ€è·å–è§£æç»“æœã€‚
    """
    service = ImageParsingService(db)

    # æäº¤åˆ°åå°ä»»åŠ¡é˜Ÿåˆ—ï¼ˆCeleryï¼‰
    from app.tasks.parsing_tasks import parse_image_task
    task = parse_image_task.apply_async(
        kwargs={
            "slide_id": request.slide_id,
            "cos_key": request.cos_key,
            "options": request.options.dict() if request.options else None,
            "user_id": user_id
        },
        queue="image_parsing"
    )

    # åˆ›å»ºä»»åŠ¡è®°å½•
    task_id = f"parse_{task.id}"

    return StandardResponse.success(
        data=ParseTaskResponse(
            task_id=task_id,
            status="pending",
            estimated_time=5
        ),
        message="è§£æä»»åŠ¡å·²åˆ›å»º"
    )


@router.get("/status/{task_id}", response_model=StandardResponse[ParseStatusResponse])
async def get_parse_status(
    task_id: str,
    db: AsyncSession = Depends(get_db)
):
    """
    æŸ¥è¯¢è§£æçŠ¶æ€

    è¿”å›ä»»åŠ¡çš„å½“å‰çŠ¶æ€å’Œè§£æç»“æœï¼ˆå¦‚æœå·²å®Œæˆï¼‰ã€‚
    """
    service = ImageParsingService(db)
    result = await service.get_parse_result(task_id)

    if not result:
        raise HTTPException(status_code=404, detail="ä»»åŠ¡ä¸å­˜åœ¨")

    return StandardResponse.success(data=result)
```

### 8.2 Celery ä»»åŠ¡

```python
# backend/app/tasks/parsing_tasks.py
from celery import shared_task
from sqlalchemy.ext.asyncio import create_async_engine, AsyncSession
from app.core.config import settings
from app.services.parsing.image_parsing_service import ImageParsingService


@shared_task(queue="image_parsing", bind=True)
def parse_image_task(
    self,
    slide_id: str,
    cos_key: str,
    options: dict = None,
    user_id: str = None
):
    """
    å¼‚æ­¥å›¾ç‰‡è§£æä»»åŠ¡
    """
    import asyncio

    async def _parse():
        engine = create_async_engine(settings.database_url)
        async with AsyncSession(engine) as db:
            service = ImageParsingService(db)
            result = await service.parse_image(
                slide_id=slide_id,
                cos_key=cos_key,
                options=options,
                user_id=user_id
            )
            return result

    # è¿è¡Œå¼‚æ­¥ä»»åŠ¡
    result = asyncio.run(_parse())
    return result.dict()
```

---

## 9. å‰ç«¯ API é…ç½®

### 9.1 API ç«¯ç‚¹é…ç½®ï¼ˆä¿®æ”¹ç°æœ‰æ–‡ä»¶ï¼‰

**æ–‡ä»¶**ï¼š`frontend/src/configs/api.ts`

åœ¨ç°æœ‰çš„ `API_CONFIG` ä¸­æ·»åŠ  `IMAGE_PARSING` é…ç½®ï¼š

```typescript
// frontend/src/configs/api.ts
export const API_CONFIG = {
  // ... ç°æœ‰é…ç½® (IMAGES, IMAGE_PROXY, IMAGE_UPLOAD, TAGS, etc.)

  // ğŸ”§ æ–°å¢ï¼šå›¾ç‰‡è§£æç›¸å…³API
  IMAGE_PARSING: {
    // è§£æå›¾ç‰‡ä¸­çš„æ–‡å­—
    PARSE: '/api/v1/image_parsing/parse',
    // æŸ¥è¯¢è§£æçŠ¶æ€
    STATUS: (taskId: string) => `/api/v1/image_parsing/status/${taskId}`,
  },

  // ... å…¶ä»–ç°æœ‰é…ç½®
} as const

export default API_CONFIG
```

### 9.2 æœåŠ¡å°è£…ï¼ˆæ–°å»ºæ–‡ä»¶ï¼‰

**æ–‡ä»¶**ï¼š`frontend/src/services/imageParsingService.ts`ï¼ˆæ–°å»ºï¼‰

```typescript
// frontend/src/services/imageParsingService.ts
import http from '@/utils/request'
import { API_CONFIG } from '@/configs/api'
import type {
  ImageParseResult,
  ParseTaskResponse,
  ParseStatusResponse
} from '@/types/imageParsing'

/**
 * å›¾ç‰‡è§£ææœåŠ¡
 */
export const imageParsingService = {
  /**
   * è§£æå›¾ç‰‡ä¸­çš„æ–‡å­—
   * @param slideId å¹»ç¯ç‰‡ID
   * @param cosKey å›¾ç‰‡COS Key
   * @returns è§£æä»»åŠ¡å“åº”
   */
  async parseSlideImage(
    slideId: string,
    cosKey: string
  ): Promise<ParseTaskResponse> {
    const { data } = await http.post(API_CONFIG.IMAGE_PARSING.PARSE, {
      slide_id: slideId,
      cos_key: cosKey
    })
    return data
  },

  /**
   * æŸ¥è¯¢è§£æçŠ¶æ€
   * @param taskId ä»»åŠ¡ID
   * @returns è§£æç»“æœ
   */
  async getParsingStatus(taskId: string): Promise<ImageParseResult> {
    const { data } = await http.get(
      API_CONFIG.IMAGE_PARSING.STATUS(taskId)
    )
    return data
  }
}

export default imageParsingService
```

**è¯´æ˜**ï¼š
- å¤ç”¨ç°æœ‰çš„ `http` å®¢æˆ·ç«¯ï¼ˆæ¥è‡ª `@/utils/request`ï¼‰
- éµå¾ªé¡¹ç›®ç°æœ‰çš„æœåŠ¡å±‚å°è£…æ¨¡å¼
- å‚è€ƒ `frontend/src/services/index.ts` çš„é£æ ¼

### 9.3 ç±»å‹å®šä¹‰ï¼ˆæ–°å»ºæ–‡ä»¶ï¼‰

**æ–‡ä»¶**ï¼š`frontend/src/types/imageParsing.ts`ï¼ˆæ–°å»ºï¼‰

```typescript
// frontend/src/types/imageParsing.ts

/**
 * è§£æä»»åŠ¡å“åº”
 */
export interface ParseTaskResponse {
  task_id: string
  status: 'pending' | 'processing' | 'completed' | 'failed'
  estimated_time: number
  message?: string
}

/**
 * è§£æçŠ¶æ€å“åº”ï¼ˆå®Œæˆæ—¶åŒ…å«å®Œæ•´ç»“æœï¼‰
 */
export interface ParseStatusResponse extends ImageParseResult {}

/**
 * è¾¹ç•Œæ¡†åæ ‡
 */
export interface BoundingBox {
  x: number
  y: number
  width: number
  height: number
}

/**
 * å­—ä½“ä¿¡æ¯
 */
export interface FontInfo {
  size: number
  family: string
  weight: 'normal' | 'bold'
  color?: string
}

/**
 * æ–‡å­—åŒºåŸŸ
 */
export interface TextRegion {
  id: string
  text: string
  bbox: BoundingBox
  confidence: number
  font?: FontInfo
}

/**
 * è§£æå…ƒæ•°æ®
 */
export interface ParseMetadata {
  parse_time: number
  ocr_engine: string
  text_count: number
  created_at: string
  completed_at?: string
}

/**
 * å›¾ç‰‡è§£æç»“æœ
 */
export interface ImageParseResult {
  task_id: string
  slide_id: string
  cos_key: string
  status: 'pending' | 'processing' | 'completed' | 'failed'
  progress: number
  text_regions: TextRegion[]
  metadata: ParseMetadata
  message?: string
}
```

**è¯´æ˜**ï¼š
- éµå¾ªé¡¹ç›®ç°æœ‰çš„ç±»å‹å®šä¹‰é£æ ¼ï¼ˆå‚è€ƒ `types/slides.ts`ï¼‰
- æ‰€æœ‰ç±»å‹éƒ½æ·»åŠ äº† JSDoc æ³¨é‡Š
- æ”¯æŒç°æœ‰çš„ TypeScript ç±»å‹æ£€æŸ¥

---

## 10. å®æ–½è·¯çº¿å›¾

### 10.1 åˆ†é˜¶æ®µå®æ–½è®¡åˆ’

#### ç¬¬ä¸€é˜¶æ®µï¼šæ ¸å¿ƒåŠŸèƒ½å®ç° (1-2å‘¨)

**ç›®æ ‡**: å®ç°åŸºç¡€çš„æ–‡å­—è¯†åˆ« + å°† OCR ç»“æœè½¬æ¢ä¸ºå¯ç¼–è¾‘å…ƒç´ ï¼ˆé®ç½© Shape + Textï¼‰å¹¶æ’å…¥å½“å‰é¡µ

- [ ] å‡†å¤‡å·¥ä½œï¼š
  - [ ] æ³¨å†Œè…¾è®¯äº‘è´¦å·å¹¶å¼€é€šOCRæœåŠ¡ï¼ˆ5åˆ†é’Ÿï¼‰
  - [ ] è·å–APIå¯†é’¥å¹¶é…ç½®ç¯å¢ƒå˜é‡

- [ ] åç«¯ï¼š
  - [ ] æ­å»º API æ¡†æ¶å’Œæ•°æ®åº“è¡¨ç»“æ„
  - [ ] é›†æˆè…¾è®¯äº‘OCR SDKï¼ˆ10åˆ†é’Ÿï¼‰
  - [ ] å®ç°å›¾ç‰‡è§£ææœåŠ¡
  - [ ] å®ç°å¼‚æ­¥ä»»åŠ¡å¤„ç†ï¼ˆCeleryï¼‰

- [ ] å‰ç«¯ï¼š
  - [ ] æ·»åŠ è§£ææŒ‰é’®åˆ°å·¥å…·æ¡
  - [ ] å®ç°â€œOCR ç»“æœ â†’ å…ƒç´ æ’å…¥â€è½¬æ¢é€»è¾‘ï¼ˆbbox æ¢ç®— + æ’å…¥ shape/text + groupId ç»‘å®šï¼‰
  - [ ] å®ç°é®ç½©è”åŠ¨ï¼ˆæ–‡æœ¬é«˜åº¦å˜åŒ–æ—¶åŒæ­¥é®ç½©é«˜åº¦ï¼‰
  - [ ] å®ç°è½®è¯¢è·å–è§£æç»“æœ

**äº¤ä»˜æ ‡å‡†**:
- ç”¨æˆ·å¯ä»¥ç‚¹å‡»è§£ææŒ‰é’®
- èƒ½è¯†åˆ«å›¾ç‰‡ä¸­çš„ä¸»è¦æ–‡å­—ï¼ˆ95%+å‡†ç¡®ç‡ï¼‰
- åœ¨å›¾ç‰‡ä¸Šæ˜¾ç¤ºæ–‡å­—æ¡†ä½ç½®
- æ–‡å­—æ¡†æ˜¾ç¤ºè¯†åˆ«çš„å†…å®¹
- æ¼”ç¤ºæ•ˆæœè‰¯å¥½

#### ç¬¬äºŒé˜¶æ®µï¼šäº¤äº’åŠŸèƒ½ (1å‘¨)

**ç›®æ ‡**: å®ç°æ–‡å­—æ¡†çš„ç¼–è¾‘å’Œæ‹–æ‹½åŠŸèƒ½

- [ ] å‰ç«¯ï¼š
  - [ ] å®ç°æ–‡å­—æ¡†ç‚¹å‡»ç¼–è¾‘åŠŸèƒ½
  - [ ] å®ç°æ–‡å­—æ¡†æ‹–æ‹½ç§»åŠ¨
  - [ ] å®ç°æ–‡å­—æ¡†æ‹–æ‹½è°ƒæ•´å¤§å°

**äº¤ä»˜æ ‡å‡†**:
- åŒå‡»æ–‡å­—æ¡†å¯ä»¥ç¼–è¾‘æ–‡å­—
- æ‹–æ‹½æ–‡å­—æ¡†å¯ä»¥ç§»åŠ¨ä½ç½®
- æ‹–æ‹½è¾¹è§’å¯ä»¥è°ƒæ•´å¤§å°

**æ³¨æ„**ï¼šæœ¬é˜¶æ®µä¸æ¶‰åŠåç«¯ä¿å­˜ï¼Œç¼–è¾‘å†…å®¹ä»…å­˜åœ¨äºå‰ç«¯å†…å­˜ä¸­

#### ç¬¬ä¸‰é˜¶æ®µï¼šä¼˜åŒ–ä¸å®Œå–„ (1å‘¨)

**ç›®æ ‡**: ä¼˜åŒ–æ€§èƒ½ï¼Œæå‡ç”¨æˆ·ä½“éªŒ

- [ ] æ€§èƒ½ä¼˜åŒ–ï¼š
  - [ ] æ·»åŠ  Redis ç¼“å­˜
  - [ ] ä¼˜åŒ–å‰ç«¯æ¸²æŸ“æ€§èƒ½
  - [ ] å®ç° WebSocket å®æ—¶æ¨é€ï¼ˆå¯é€‰ï¼‰

- [ ] ç”¨æˆ·ä½“éªŒï¼š
  - [ ] æ·»åŠ åŠ è½½åŠ¨ç”»å’Œè¿›åº¦æç¤º
  - [ ] æ·»åŠ é”™è¯¯å¤„ç†å’Œé‡è¯•æœºåˆ¶
  - [ ] ä¼˜åŒ–æ–‡å­—æ¡†æ ·å¼

**äº¤ä»˜æ ‡å‡†**:
- è§£æé€Ÿåº¦ < 5 ç§’
- æµç•…çš„ç¼–è¾‘ä½“éªŒ
- å®Œå–„çš„é”™è¯¯å¤„ç†

### 10.2 æŠ€æœ¯é‡Œç¨‹ç¢‘

| é˜¶æ®µ | é‡Œç¨‹ç¢‘ | å®Œæˆæ ‡å‡† |
|------|--------|----------|
| Phase 1 | MVPå‘å¸ƒ | æ–‡å­—å¯è¯†åˆ«å’Œæ˜¾ç¤º |
| Phase 2 | å¯ç¼–è¾‘ | æ–‡å­—å¯ç¼–è¾‘å’Œç§»åŠ¨ |
| Phase 3 | ç”Ÿäº§å°±ç»ª | æ€§èƒ½å’Œç¨³å®šæ€§è¾¾æ ‡ |

---

## 11. é£é™©ä¸æŒ‘æˆ˜

### 11.1 æŠ€æœ¯é£é™©

| é£é™© | å½±å“ | æ¦‚ç‡ | ç¼“è§£æªæ–½ |
|------|------|------|----------|
| OCRè¯†åˆ«å‡†ç¡®ç‡ä¸è¶³ | é«˜ | ä½ | 1. MVPé˜¶æ®µä½¿ç”¨è…¾è®¯äº‘OCRï¼ˆ95%+å‡†ç¡®ç‡ï¼‰<br>2. æœªæ¥å¯åˆ‡æ¢åˆ°æ›´é«˜ç²¾åº¦çš„æ–¹æ¡ˆ<br>3. æ·»åŠ ç½®ä¿¡åº¦æç¤º<br>4. æ”¯æŒç”¨æˆ·æ‰‹åŠ¨ä¿®æ­£ç¼–è¾‘ |
| æ€§èƒ½ç“¶é¢ˆ | ä¸­ | ä½ | 1. MVPé˜¶æ®µCPUå³å¯<br>2. ç”Ÿäº§ç¯å¢ƒä½¿ç”¨GPUåŠ é€Ÿ<br>3. å¼‚æ­¥å¤„ç†<br>4. Redisç¼“å­˜ç»“æœ |
| æœåŠ¡å™¨èµ„æºå ç”¨ | ä¸­ | ä¸­ | 1. ä½¿ç”¨Celeryä»»åŠ¡é˜Ÿåˆ—<br>2. é™åˆ¶å¹¶å‘æ•°é‡<br>3. ç›‘æ§èµ„æºä½¿ç”¨ |

### 11.2 ä¸šåŠ¡é£é™©

| é£é™© | å½±å“ | æ¦‚ç‡ | ç¼“è§£æªæ–½ |
|------|------|------|----------|
| ç”¨æˆ·æœŸæœ›è¿‡é«˜ | ä¸­ | é«˜ | 1. æ˜ç¡®åŠŸèƒ½è¾¹ç•Œ<br>2. æä¾›ä½¿ç”¨è¯´æ˜<br>3. æ”¶é›†åé¦ˆæŒç»­ä¼˜åŒ– |

---

## 12. é™„å½•

### 12.1 ç›¸å…³èµ„æ–™é“¾æ¥

**OCRä¸æ–‡æ¡£è§£æï¼ˆMVP é˜¶æ®µæ¨èï¼‰**:
- [è…¾è®¯äº‘ OCR API](https://cloud.tencent.com/product/ocr) - é¦–é€‰æ–¹æ¡ˆï¼Œ95%+å‡†ç¡®ç‡
- [è…¾è®¯äº‘ Python SDK](https://cloud.tencent.com/document/sdk/Python)
- [é˜¿é‡Œäº‘ OCR API](https://www.aliyun.com/product/ocr) - å¤‡é€‰æ–¹æ¡ˆ

**ç”Ÿäº§ç¯å¢ƒå¤‡é€‰æ–¹æ¡ˆ**:
- [PaddleOCR å®˜æ–¹æ–‡æ¡£](https://paddlepaddle.github.io/PaddleOCR/main/en/index.html)
- [PaddleOCR GitHub](https://github.com/PaddlePaddle/PaddleOCR)

**å‰ç«¯æŠ€æœ¯**:
- [Vue 3 å®˜æ–¹æ–‡æ¡£](https://vuejs.org/)
- [TypeScript å®˜æ–¹æ–‡æ¡£](https://www.typescriptlang.org/)

### 12.2 æœ¯è¯­è¡¨

| æœ¯è¯­ | è¯´æ˜ |
|------|------|
| OCR | Optical Character Recognitionï¼Œå…‰å­¦å­—ç¬¦è¯†åˆ« |
| æ–‡å­—åŒºåŸŸ | å›¾ç‰‡ä¸­æ£€æµ‹åˆ°çš„æ–‡å­—åŒºåŸŸï¼ŒåŒ…å«æ–‡å­—å†…å®¹å’Œä½ç½®ä¿¡æ¯ |
| è¾¹ç•Œæ¡† (BBox) | Bounding Boxï¼ŒåŒ…å›´æ–‡å­—åŒºåŸŸçš„çŸ©å½¢æ¡† |
| ç½®ä¿¡åº¦ | OCRè¯†åˆ«ç»“æœçš„å¯ä¿¡ç¨‹åº¦ï¼Œ0-1ä¹‹é—´çš„å€¼ |
| æ–‡ç”Ÿå›¾ | Text-to-Image Generationï¼Œæ ¹æ®æ–‡å­—æè¿°ç”Ÿæˆå›¾ç‰‡ |
| é¦™è•‰ç”Ÿæˆ | æœ¬é¡¹ç›®çš„PPTç”ŸæˆåŠŸèƒ½ä»£å· |

### 12.3 ç‰ˆæœ¬å†å²

| ç‰ˆæœ¬ | æ—¥æœŸ | ä½œè€… | è¯´æ˜ |
|------|------|------|------|
| v1.0 | 2024-12-24 | Claude Code | åˆå§‹ç‰ˆæœ¬ |
| v2.0 | 2024-12-24 | Claude Code | ç®€åŒ–ç‰ˆæœ¬ï¼Œç§»é™¤PPTXå¯¼å‡ºï¼Œèšç„¦æ–‡å­—è¯†åˆ« |
| v3.0 | 2024-12-24 | Claude Code | MVPä¼˜åŒ–ï¼Œæ¨èEasyOCRä½œä¸ºå¿«é€ŸåŸå‹æ–¹æ¡ˆ |
| v4.0 | 2024-12-24 | Claude Code | MVPä¼˜åŒ–ï¼Œæ¨èè…¾è®¯äº‘OCR APIï¼ˆæœ€ä½³æ¼”ç¤ºæ•ˆæœï¼‰ |
| v5.0 | 2024-12-24 | Claude Code | **èŒƒå›´æ¾„æ¸…**ï¼šç§»é™¤ä¿å­˜åŠŸèƒ½ï¼Œæ˜ç¡®ç¼–è¾‘å†…å®¹ä»…å­˜åœ¨äºå‰ç«¯å†…å­˜ |
| v6.0 | 2024-12-24 | Claude Code | **å‰ç«¯æ–¹æ¡ˆä¼˜åŒ–**ï¼šå¤ç”¨ EditableElement + é®ç½©å±‚æ›¿ä»£è‡ªå®šä¹‰ DraggableTextBox |

---

## å‚è€ƒèµ„æ–™

**MVP é˜¶æ®µï¼ˆè…¾è®¯äº‘OCRï¼‰**:
1. [è…¾è®¯äº‘ OCR äº§å“](https://cloud.tencent.com/product/ocr)
2. [è…¾è®¯äº‘ Python SDK](https://cloud.tencent.com/document/sdk/Python)
3. [è…¾è®¯äº‘ OCR API æ–‡æ¡£ - é€šç”¨å°åˆ·ä½“è¯†åˆ«](https://cloud.tencent.com/document/product/866/33526)

**ç”Ÿäº§ç¯å¢ƒå¤‡é€‰**:
4. [PaddleOCR Documentation](https://paddlepaddle.github.io/PaddleOCR/)
5. [PaddleOCR GitHub](https://github.com/PaddlePaddle/PaddleOCR)
6. [é˜¿é‡Œäº‘ OCR](https://www.aliyun.com/product/ocr)

**åç«¯æ¡†æ¶**:
7. [FastAPI Documentation](https://fastapi.tiangolo.com/)
8. [Celery Documentation](https://docs.celeryq.dev/)

**å‰ç«¯æ¡†æ¶**:
9. [Vue 3 Documentation](https://vuejs.org/)
10. [TypeScript Documentation](https://www.typescriptlang.org/)
