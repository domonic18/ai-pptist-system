# 智能PPT模板自动化标注系统需求文档 v1.0

## 1. 需求背景

### 1.1 当前痛点分析

#### 痛点1: 人工标注过程繁琐耗时
目前制作PPT模板需要人工进行页面元素标注，完整流程包括：

1. **导入PPTX文件** → 2. **选择页面** → 3. **选择页面类型** → 4. **逐个元素标注** → 5. **可选:选择布局类型** → 6. **可选:选择场景类型**

**问题体现：**
- 每个元素都需要手动选择类型（标题、列表项、列表项标题、编号等）
- 一个典型PPT有20-30页，每页5-10个元素，总共需要100-300次手动操作
- 标注过程重复性高，效率低下

#### 痛点2: 专业知识门槛高
**布局类型选择（第4步）** 和 **场景类型选择（第5步）** 存在的问题：

- 非专业人士难以理解SmartArt布局类型的区别（如vertical_list vs horizontal_list）
- 不了解不同布局适用的场景，选择准确性差
- 对内容语义理解不足，无法准确匹配布局与内容
- 需要设计专业知识，普通用户难以胜任

#### 痛点3: 一致性难以保证
- 不同用户的标注标准不统一
- 标注质量参差不齐，影响后续模板匹配效果
- 元素类型识别主观性强，容易出错

### 1.2 业务价值

#### 对模板制作人员
- **效率提升10倍**：从手动300次操作 → 自动标注 + 一次性确认
- **降低门槛**：无需专业设计知识，系统自动完成专业标注
- **质量保证**：基于AI的标注一致性高，减少人为错误

#### 对系统整体
- **模板库质量提升**：标准化标注提升模板匹配准确率
- **用户体验优化**：简化模板制作流程，提高用户满意度
- **扩展性增强**：快速构建高质量模板库，支撑业务发展

## 2. 功能概述

### 2.1 功能名称
智能PPT模板自动化标注系统

### 2.2 功能目标
- 实现PPT模板的自动化智能标注，减少90%以上的人工操作
- 利用多模态大模型理解幻灯片内容和视觉布局
- 自动识别页面类型、布局类型和元素类型
- 提供可视化标注过程和用户确认机制
- 无缝对接现有模板导出功能

### 2.3 核心价值主张
**"导入PPTX，AI自动理解并标注每一处设计细节"**

## 3. 详细需求

### 3.1 功能流程设计

```
┌─────────────────────────────────────────────────────────────────┐
│                    智能PPT模板自动化标注流程                        │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  用户导入PPTX文件                                                  │
│         │                                                        │
│         ▼                                                        │
│  ┌──────────────────────────┐                                   │
│  │  触发自动标注功能入口      │  ← 新增:标注按钮/自动触发            │
│  └─────────────┬────────────┘                                   │
│                │                                                │
│                ▼                                                │
│  ┌──────────────────────────┐                                   │
│  │  幻灯片截图 + JSON提取     │  ← 新增:截图+元素数据提取           │
│  │  - 每页生成截图           │                                   │
│  │  - 提取元素JSON数据       │                                   │
│  └─────────────┬────────────┘                                   │
│                │                                                │
│                ▼                                                │
│  ┌──────────────────────────┐                                   │
│  │  调用多模态LLM进行分析     │  ← 新增:LLM API调用                │
│  │  - 页面类型识别           │                                   │
│  │  - 布局类型识别           │                                   │
│  │  - 元素类型识别           │                                   │
│  └─────────────┬────────────┘                                   │
│                │                                                │
│                ▼                                                │
│  ┌──────────────────────────┐                                   │
│  │  返回结构化标注结果        │  ← 新增:结果解析                   │
│  │  - pageType              │                                   │
│  │  - layoutType            │                                   │
│  │  - elements[]            │                                   │
│  └─────────────┬────────────┘                                   │
│                │                                                │
│                ▼                                                │
│  ┌──────────────────────────┐                                   │
│  │  前端自动标注渲染          │  ← 新增:动画效果+可视化标注        │
│  │  - 元素高亮动效           │                                   │
│  │  - 标注信息展示           │                                   │
│  │  - 置信度显示             │                                   │
│  └─────────────┬────────────┘                                   │
│                │                                                │
│                ▼                                                │
│  ┌──────────────────────────┐                                   │
│  │  用户二次确认/编辑        │  ← 优化:可视化确认界面             │
│  │  - 查看标注结果           │                                   │
│  │  - 修改错误标注           │                                   │
│  │  - 批量确认               │                                   │
│  └─────────────┬────────────┘                                   │
│                │                                                │
│                ▼                                                │
│  ┌──────────────────────────┐                                   │
│  │  导出模板文件             │  ← 复用:现有导出功能               │
│  │  - PPTist格式            │                                   │
│  │  - JSON格式              │                                   │
│  └──────────────────────────┘                                   │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

### 3.2 功能入口设计

#### 3.2.1 触发方式
- 在PPT导入后，工具栏显示"智能标注"按钮
- 按钮样式：✨ 图标 + "一键智能标注"文字
- 位置：工具栏右侧，靠近导出按钮
- 状态：导入PPTX后启用，未导入时禁用

### 3.3 核心功能模块

#### 3.3.1 幻灯片数据提取模块

**功能描述：**
提取每页幻灯片的截图和元素JSON数据，作为LLM的输入

**输入：**
- PPTX文件（已导入到系统）
- 幻灯片页码范围（可配置，如1-10页）

**处理流程：**
```
1. 遍历指定范围的幻灯片
2. 对每页幻灯片：
   a. 渲染幻灯片到Canvas
   b. 生成PNG/JPEG截图（Base64编码）
   c. 提取元素JSON数据：
      - 元素ID、类型、位置、尺寸
      - 文本内容（如果有）
      - 样式属性（颜色、字体等）
   d. 组合为SlideData对象
3. 返回SlideData[]数组
```

**技术实现要点：**
- 使用Canvas API渲染幻灯片
- 截图分辨率：1920x1080（保证清晰度）
- 截图质量：0.9（平衡清晰度和文件大小）
- 异步批量处理，避免阻塞主线程
- 支持断点续传（如果标注过程中断）

**性能要求：**
- 单页截图 + 数据提取 < 500ms
- 10页批量处理 < 5秒
- 内存占用 < 50MB

#### 3.3.2 LLM分析服务模块

**功能描述：**
调用多模态大模型，分析幻灯片截图和元素数据，自动识别页面类型、布局类型和元素类型

**支持的LLM模型：**
1. 模型可以由用户在模型管理配置界面中进行配置
2. 模型配置管理界面中需要给模型的配置项增加多模态的选项


**错误处理：**
- LLM调用超时（>30秒）：重试1次，仍失败则降级为手动标注
- LLM返回格式错误：尝试修复JSON，无法修复则标记该页为手动标注
- LLM置信度过低（<0.6）：提示用户手动审核该页标注
- API配额不足：优雅降级，提示用户切换模型或减少标注页数


#### 3.3.3 自动标注渲染模块

**功能描述：**
接收LLM返回的标注结果，在前端以动画形式展示标注过程

**视觉设计：**

**标注状态：**
```
1. 提取中（黄色）
   ├─ 显示："正在提取第 3/10 页数据..."
   ├─ 动画：旋转loading图标
   └─ 进度：进度条 30%

2. 分析中（蓝色）
   ├─ 显示："AI正在分析幻灯片结构..."
   ├─ 动画：脉冲效果
   └─ 预计剩余时间：45秒

3. 标注中（绿色）
   ├─ 显示："正在标注第 3/10 页..."
   ├─ 动画：每页标注时有元素高亮效果
   └─ 实时显示当前页标注进度

4. 完成（成功绿）
   ├─ 显示："标注完成！共标注 10 页"
   ├─ 总耗时：32秒
   └─ LLM调用次数：10次

5. 错误（红色）
   ├─ 显示：第5页标注失败
   └─ 操作：重试/跳过/手动标注
```

**单页标注动画效果：**
```typescript
// 标注动画序列（每页）
1. 页面渐显（500ms）
   - 幻灯片截图淡入显示

2. 页面类型标注（1000ms）
   - 顶部显示page_type标签
   - 标签从透明度0 → 1，带缩放动画
   - 显示置信度分数

3. 布局类型标注（1000ms）
   - 显示layout_type标签
   - 标签滑入动画（从右侧滑入）
   - 显示布局图标和名称

4. 元素逐个标注（每元素500ms，并行最多3个）
   - 元素周围出现高亮边框
   - 显示元素类型标签（固定在元素右上角）
   - 标签带小箭头指向元素
   - 置信度低时标签显示黄色警告
   - 元素标注时轻微脉冲效果

5. 页面标注完成（500ms）
   - 所有标注信息完整显示
   - 显示"第3页标注完成"提示
   - 自动进入下一页（或等待用户确认）
```

**交互功能：**
```typescript
// 标注标签可交互
1. 点击标签：显示详细信息和识别依据
   ├─ 弹出tooltip显示reason
   ├─ 显示该元素的其他候选类型
   └─ 提供"修改类型"按钮

2. 拖拽标签：调整标签位置避免重叠
   ├─ 保存位置偏移量
   └─ 自动调整箭头指向

3. 右键菜单：快速操作
   ├─ 修改元素类型
   ├─ 删除标注（如果识别错误）
   ├─ 重新识别该元素
   └─ 标记为不确定

4. 置信度点击：
   ├─ 显示置信度计算详情
   └─ 显示影响置信度的因素
```

**批量操作：**
```typescript
// 工具栏提供批量操作
1. 批量修改相同类型元素
   ├─ 选择所有type='item'的元素
   ├─ 批量修改为'content'类型
   └─ 应用修改

2. 批量确认页面标注
   ├─ 当前页面所有标注确认
   └─ 跳转到下一未确认页面

3. 批量撤销
   ├─ 撤销整个页面的标注
   └─ 恢复到未标注状态

4. 自动修正低置信度项
   ├─ 扫描所有confidence < 0.7的元素
   ├─ 基于相邻元素和页面类型智能推测
   └─ 应用修正建议
```

#### 3.3.4 用户确认与编辑模块

**功能描述：**
提供用户审核、修改标注结果的功能，确保标注准确性

**确认流程：**
```typescript
// 三阶段确认流程

阶段1: 快速预览（总览）
├─ 显示所有页面的缩略图
├─ 每页缩略图显示:
│  ├─ 绿色✓（全部确认）
│  ├─ 黄色!（部分需要审核）
│  └─ 灰色?（未确认）
├─ 显示标注统计:
│  ├─ 总页数: 10
│  ├─ 已确认: 3页
│  ├─ 需审核: 4页
│  └─ 未确认: 3页
└─ 点击缩略图跳转到详细编辑

阶段2: 详细审核（逐页）
├─ 显示当前页面的完整标注
├─ 标注信息列表（按元素顺序）:
│  ├─ 元素预览图
│  ├─ 识别的类型
│  ├─ 置信度
│  ├─ 快速操作: ✓ 确认 / ✏️ 编辑
│  └─ 点击展开: 显示识别依据和其他候选
├─ 提供筛选和排序:
│  ├─ 按置信度排序（低到高）
│  ├─ 只显示低置信度（<0.7）
│  └─ 只显示特定类型的元素
└─ 页面级操作:
  ├─ "确认本页标注"按钮
  ├─ "重新标注本页"按钮
  └─ "标记为手动标注"按钮

阶段3: 批量提交（完成）
├─ 显示所有标注的汇总
ewn├─ 按页面类型分组统计
├─ 按布局类型分组统计
├─ 按元素类型分组统计
├─ 导出前检查:
│  ├─ 是否所有页面都已确认
│  ├─ 是否有低置信度项未审核
│  └─ 是否有标注冲突（同一类型多个元素）
└─ "生成模板文件"按钮
```

**编辑功能：**

1. **修改元素类型**
```typescript
// 交互方式：
- 点击标注标签的"编辑"按钮
- 弹出下拉选择框
- 显示所有支持的ElementType枚举值
- 按类别分组：
  ├─ 文本类型（slide_title, subtitle, item_title, item, content, number, decoration）
  ├─ 形状类型（title_bg, item_bg, section_bg, decoration, icon）
  ├─ 图片类型（main_image, background_image, icon_image, decoration_image）
  └─ SVG类型（chart, arrow, bullet, decoration）
- 支持搜索过滤
- 选择后实时更新标注
```

2. **添加缺失标注**
```typescript
// 场景：LLM遗漏了某个元素
- 用户右键点击未标注的元素
- 菜单："添加标注"
- 弹出类型选择对话框
- 选择类型后生成标注
- 置信度标记为`1.0`（人工确认）
```

3. **删除错误标注**
```typescript
// 场景：LLM识别错误
- 点击标注标签的"删除"按钮
- 确认删除对话框
- 删除该标注
- 元素恢复为未标注状态
```

4. **批量编辑**
```typescript
// 批量选择同类元素
- 按Shift+点击选择多个元素
- 或框选区域
- 批量修改类型
- 批量确认
- 批量删除
```

5. **智能辅助编辑**
```typescript
// 基于上下文的智能建议
- 选中一个元素时，显示"智能建议"
- 基于：
  ├─ 页面类型（封面页建议slide_title）
  ├─ 元素位置（顶部元素可能是标题）
  ├─ 元素大小（大文本可能是标题）
  ├─ 视觉样式（粗体可能是标题）
  └─ 相邻元素（列表项通常是item）
- 显示Top 3建议
- 一键应用建议
```

### 4 参考文档

- [AIPPT多维度智能匹配机制设计方案](./docs/arch/AIPPT生成流程管理/AIPPT多维度智能匹配机制设计方案.md)
- [PPT内容排版优化功能需求文档](./docs/requirement/需求文档v0.2.md)
- [LLM最佳实践 - OpenAI Cookbook](https://cookbook.openai.com/)
- [提示词工程指南](https://www.promptingguide.ai/)

---

**文档版本**: v1.0
**创建日期**: 2025-01-10
**作者**: AI Assistant
**最后更新**: 2025-01-10
**状态**: 评审中
**审批人**: [待填写]
