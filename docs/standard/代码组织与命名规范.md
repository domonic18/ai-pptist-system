# AI PPTist System - 代码组织与命名规范

## 1. 文档概述

本文档定义了 AI PPTist System 项目的代码组织和命名规范，旨在确保代码的可读性、可维护性和一致性。

### 1.1 适用范围

- 后端 Python/FastAPI 项目
- 前端 Vue 3/TypeScript 项目
- 所有新增代码和重构工作

### 1.2 规范原则

1. **清晰性优先** - 命名应该一目了然，不需要额外的注释就能理解
2. **一致性** - 同类型的代码使用相同的命名模式
3. **符合行业规范** - 遵循 REST API、Python PEP 8、TypeScript 等标准
4. **可扩展性** - 命名和组织方式应该支持项目的长期发展

---

## 2. 当前问题分析

### 2.1 命名不一致问题

| 问题类型 | 示例 | 说明 |
|----------|------|------|
| **端点文件命名不统一** | `image_manager.py` vs `image_upload.py` | 同一类型文件应该使用相同格式 |
| **服务层命名混乱** | `management_handler.py` vs `tag_handler.py` | 前者描述的是"管理"，后者是"标签"，不对应 |
| **Schema命名不明确** | `tag.py` | 无法区分是标签库还是图片标签 |
| **容易混淆** | `tags.py` vs `image_tags.py` | 两者功能不同，但命名容易混淆 |

### 2.2 代码组织问题

```
当前服务层组织：
services/
├── image/              # 图片相关服务
│   ├── tag_handler.py
│   ├── tag_service.py
│   ├── search_handler.py
│   ├── search_service.py
│   ├── management_handler.py    # ❌ 应该是 manager_handler
│   ├── management_service.py    # ❌ 应该是 manager_service
│   └── ...
├── layout/             # 布局优化
├── ai_model/           # AI模型管理
├── generation/         # 生成服务
├── editing/            # 编辑服务
└── cache/              # 缓存服务
```

---

## 3. 命名规则

### 3.1 Python 文件命名（snake_case）

#### 规则

```python
# ✅ 正确 - 使用 snake_case
image_upload.py
image_search.py
image_tagging.py
tag_library.py

# ❌ 错误 - 使用 PascalCase 或驼峰
ImageUpload.py
imageUpload.py
image-Tagging.py
```

#### 专用后缀

| 后缀 | 用途 | 示例 |
|------|------|------|
| `_handler.py` | 处理器层，处理请求/响应 | `image_upload_handler.py` |
| `_service.py` | 业务逻辑层 | `image_upload_service.py` |
| `_tasks.py` | Celery 异步任务 | `image_processing_tasks.py` |

### 3.2 API 端点文件命名

#### 格式

```
{domain}_{action}.py 或 {resource}_{operation}.py
```

#### 示例

| 当前命名 | 推荐命名 | 说明 |
|----------|----------|------|
| `tags.py` | `tag_library.py` | 标签库管理 |
| `image_tags.py` | `image_tagging.py` | 图片标签操作 |
| `image_manager.py` | `image_management.py` | 图片管理 |
| `generation.py` | `outline_generation.py` | 大纲生成 |

### 3.3 URL 路由命名（kebab-case）

#### 规则

```python
# ✅ 正确 - 使用 kebab-case
/tag-library
/image-tagging
/banana-generation

# ❌ 错误 - 使用 snake_case 或 camelCase
/tag_library
/imageTagging
/bananaGeneration
```

#### RESTful 资源命名

| 类型 | 格式 | 示例 |
|------|------|------|
| **集合** | `/resources` | `/images`, `/tags` |
| **单个资源** | `/resources/{id}` | `/images/{id}` |
| **嵌套资源** | `/parents/{id}/children` | `/images/{id}/tags` |
| **动作操作** | `/resources/{id}/actions` | `/images/{id}/optimize` |

### 3.4 Schema 文件命名

#### 规则

```
{domain}.py 或 {feature}.py
```

#### 示例

| 当前命名 | 推荐命名 | 说明 |
|----------|----------|------|
| `tag.py` | `tag_library.py` | 标签库相关 Schema |
| 新增 | `image_tagging.py` | 图片标签相关 Schema |

### 3.5 模型和类命名（PascalCase）

#### 规则

```python
# ✅ 正确
class Tag(Base):                    # 模型使用单数
class TagCreate(BaseModel):         # Schema 使用描述性名称
class ImageTaggingHandler:          # Handler 类使用完整描述

# ❌ 错误
class tag(Base):                    # 类名应该用 PascalCase
class Tags(Base):                   # 模型应该用单数
```

### 3.6 函数和方法命名（snake_case）

```python
# ✅ 正确
async def get_all_tags()
async def create_tag()
async def add_image_tags()

# ❌ 错误
async def GetAllTags()              # 函数名不应该用 PascalCase
async def addImageTags()            # 函数名不应该用 camelCase
```

---

## 4. 代码组织结构

### 4.1 后端项目结构

```
backend/app/
├── api/v1/
│   └── endpoints/                  # API 端点
│       ├── image_management.py
│       ├── image_tagging.py
│       ├── tag_library.py
│       └── ...
├── services/                       # 业务逻辑
│   ├── image/
│   │   ├── management/
│   │   │   ├── handler.py
│   │   │   └── service.py
│   │   ├── tagging/
│   │   │   ├── handler.py
│   │   │   └── service.py
│   │   └── upload/
│   │       ├── handler.py
│   │       └── service.py
│   ├── tag/
│   │   ├── library/
│   │   │   ├── handler.py
│   │   │   └── service.py
│   │   └── ...
│   └── ...
├── schemas/                        # Pydantic 模型
│   ├── image_management.py
│   ├── image_tagging.py
│   ├── tag_library.py
│   └── ...
├── models/                         # 数据库模型
│   ├── image.py
│   ├── tag.py
│   └── ...
└── repositories/                   # 数据访问层
    ├── image.py
    ├── tag.py
    └── ...
```

### 4.2 模块组织规则

#### 按业务领域分组

```python
# 推荐的模块组织方式
services/
├── image/              # 图片相关
│   ├── management/     # 图片管理
│   ├── tagging/        # 图片标签
│   ├── upload/         # 图片上传
│   ├── search/         # 图片搜索
│   └── generation/     # 图片生成
├── tag/                # 标签相关
│   └── library/        # 标签库
├── generation/         # 生成相关
│   ├── outline/        # 大纲生成
│   └── banana/         # Banana 生成
├── editing/            # 编辑相关
└── ...
```

#### 模块内文件组织

```
{domain}/
├── {action}/
│   ├── handler.py      # 请求处理器
│   └── service.py      # 业务逻辑
```

### 4.3 前端项目结构

```
frontend/src/
├── services/                       # API 服务
│   ├── imageManagement.ts
│   ├── imageTagging.ts
│   ├── tagLibrary.ts
│   └── ...
├── types/                          # TypeScript 类型
│   ├── image.ts
│   ├── tag.ts
│   └── ...
└── configs/
    └── api.ts                      # API 配置
```

---

## 5. 具体重构方案

### 5.1 标签相关代码重构

#### 端点文件

| 当前文件 | 新文件 | 说明 |
|----------|--------|------|
| `tags.py` | `tag_library.py` | 标签库管理端点 |
| `image_tags.py` | `image_tagging.py` | 图片标签操作端点 |

#### 服务文件

| 当前文件 | 新文件 | 说明 |
|----------|--------|------|
| `services/image/tag_handler.py` | `services/tag/library/handler.py` | 标签库处理器 |
| `services/image/tag_service.py` | `services/tag/library/service.py` | 标签库服务 |
| 新增 | `services/image/tagging/handler.py` | 图片标签处理器 |
| 新增 | `services/image/tagging/service.py` | 图片标签服务 |

#### Schema 文件

| 当前文件 | 新文件 | 说明 |
|----------|--------|------|
| `schemas/tag.py` | 拆分 | 需要拆分为两个文件 |
| - | `schemas/tag_library.py` | 标签库 Schema |
| - | `schemas/image_tagging.py` | 图片标签 Schema |

### 5.2 其他命名调整

| 当前命名 | 推荐命名 | 原因 |
|----------|----------|------|
| `image_manager.py` | `image_management.py` | 与 `image_xxx.py` 格式统一 |
| `services/image/management_handler.py` | `services/image/management/handler.py` | 放入子目录，与模块组织一致 |

### 5.3 路由配置调整

```python
# 当前
api_router.include_router(tags.router, prefix="/tags", tags=["标签管理"])
api_router.include_router(image_tags.router, prefix="/images", tags=["图片标签"])

# 重构后
api_router.include_router(tag_library.router, prefix="/tag-library", tags=["标签库管理"])
api_router.include_router(image_tagging.router, prefix="/images", tags=["图片标签操作"])
```

---

## 6. 前端 API 配置规范

### 6.1 命名规则

```typescript
// 使用 PascalCase + 语义化后缀
export const API_CONFIG = {
  TAG_LIBRARY: {              // ✅ 清晰的命名
    LIST: "/api/v1/tag-library",
    POPULAR: "/api/v1/tag-library/popular",
  },
  IMAGE_TAGGING: {            // ✅ 清晰的命名
    GET: (imageId) => `/api/v1/images/${imageId}/tags`,
    ADD: (imageId) => `/api/v1/images/${imageId}/tags`,
  },
}
```

### 6.2 Service 文件命名

```typescript
// ✅ 正确 - 使用 PascalCase，语义化
imageTaggingService.ts
tagLibraryService.ts
imageManagementService.ts

// ❌ 错误
imageTagsService.ts           // 不明确
tagsService.ts                // 更不明确
```

---

## 7. 实施步骤

### 7.1 重构顺序

1. **创建新的服务文件**（不影响现有代码）
2. **创建新的 Schema 文件**
3. **创建新的端点文件**
4. **更新路由配置**
5. **更新前端 API 配置**
6. **测试验证**
7. **删除旧文件**

### 7.2 验证清单

- [ ] 所有端点正常工作
- [ ] 前端 API 调用正常
- [ ] 测试用例通过
- [ ] 文档更新完成
- [ ] 代码审查通过

---

## 8. 参考资源

### 8.1 行业最佳实践

- [FastAPI Official Docs - Bigger Applications](https://fastapi.tiangolo.com/tutorial/bigger-applications/)
- [GitHub: fastapi-best-practices](https://github.com/zhanymkanov/fastapi-best-practices)
- [REST API URI Naming Conventions](https://restfulapi.net/resource-naming/)
- [Azure API Design Best Practices](https://learn.microsoft.com/en-us/azure/architecture/best-practices/api-design)
- [Moesif: Ultimate Guide to REST API Naming](https://www.moesif.com/blog/technical/api-development/The-Ultimate-Guide-to-REST-API-Naming-Convention/)

### 8.2 项目规范

- `docs/standard/API设计与实现规范.md`
- `docs/standard/API响应与日志规范.md`
- `docs/standard/前端API配置说明.md`

---

## 9. 修订历史

| 版本 | 日期 | 修订人 | 修订内容 |
|------|------|--------|----------|
| 1.0 | 2024-12-28 | Claude | 初始版本 |

---

## 10. 附录

### 10.1 完整的命名对照表

| 类型 | 当前命名 | 推荐命名 |
|------|----------|----------|
| 端点 | `tags.py` | `tag_library.py` |
| 端点 | `image_tags.py` | `image_tagging.py` |
| 端点 | `image_manager.py` | `image_management.py` |
| 服务 | `tag_handler.py` | `tag/library/handler.py` |
| 服务 | `tag_service.py` | `tag/library/service.py` |
| Schema | `tag.py` | `tag_library.py` (需拆分) |
| 路由 | `/tags` | `/tag-library` |

### 10.2 术语对照

| 中文 | 英文 | 说明 |
|------|------|------|
| 标签库 | Tag Library | 系统中可用的标签集合 |
| 图片标签 | Image Tagging | 给图片打标签的操作 |
| 管理 | Management | CRUD 操作 |
| 处理器 | Handler | 处理请求/响应的层 |
| 服务 | Service | 业务逻辑层 |
